!function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"Main",(function(){return Ke}));var a={canvasHeight:800,canvasWidth:1040,frameRate:60,msBetweenRenders:1e3/60};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var r=function(){return(r=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function i(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],a=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var a,r,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}var l,c,y=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.getMagnitude=function(){return Math.sqrt(this.dot(this))},t.prototype.normalize=function(){var e=this.getMagnitude();return new t(this.x/e,this.y/e)},t.prototype.multiplyScaler=function(e){return new t(this.x*e,this.y*e)},t.prototype.distanceTo=function(t){return t.subtract(this).getMagnitude()},t.prototype.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},t.prototype.getPointRotationRadians=function(){return Math.atan2(this.y,this.x)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t.prototype.getNormalVectorClockwise=function(){return new t(this.y,-this.x)},t.prototype.getNormalVectorCounterclockwise=function(){return new t(-this.y,this.x)},t.prototype.reflect=function(t){return this.subtract(t.multiplyScaler(2*this.dot(t)))},t}();function h(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return!0;return!1}function u(t){return new y(t.x,t.y)}!function(t){t[t.KeyDown=0]="KeyDown",t[t.KeyUp=1]="KeyUp",t[t.KeyPress=2]="KeyPress"}(l||(l={})),function(t){t[t.NOT_STARTED=0]="NOT_STARTED",t[t.READY=1]="READY",t[t.DOWN=2]="DOWN"}(c||(c={}));var x,d=function(){function t(){this.assignedControls=new Map,this.keyToEventType=new Map,this.keyToKeyPressState=new Map}return t.prototype.add=function(t){this.assignedControls.set(t.key,t.func),p.addAssignedControl(t.key,t.name),this.keyToEventType.set(t.key,t.eventType),t.eventType===l.KeyPress&&this.keyToKeyPressState.set(t.key,p.isKeyDown(t.key)?c.NOT_STARTED:c.READY)},t.prototype.remove=function(t){p.removeAssignedControl(t),this.assignedControls.delete(t),this.keyToEventType.delete(t)},t.prototype.clear=function(){var t,e;try{for(var n=i(this.assignedControls.keys()),a=n.next();!a.done;a=n.next()){var r=a.value;p.removeAssignedControl(r)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.assignedControls.clear(),this.keyToEventType.clear()},t.prototype.check=function(){var t,e;try{for(var n=i(this.assignedControls.keys()),a=n.next();!a.done;a=n.next()){var r=a.value,o=this.keyToEventType.get(r),s=p.isKeyDown(r);if(o===l.KeyDown&&s||o===l.KeyUp&&!s)this.assignedControls.get(r)();else if(o===l.KeyPress){var y=this.keyToKeyPressState.get(r);if(s)y===c.READY&&this.keyToKeyPressState.set(r,c.DOWN);else switch(y){case c.DOWN:this.assignedControls.get(r)(),this.keyToKeyPressState.set(r,c.READY);break;case c.NOT_STARTED:this.keyToKeyPressState.set(r,c.READY)}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t}(),f=function(){function t(){var t,e,n=this;this.keyMap=new Map,this.assignedControlMap=new Map,this.mouseCanvasCoords=new y(0,0),this.isMouseDownInternal=!1,this.hasClickInternal=!1;var a=Object.keys(x).filter((function(t){return!isNaN(Number(x[t]))}));try{for(var r=i(a),o=r.next();!o.done;o=r.next()){var s=o.value;this.keyMap.set(x[s],!1)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}document.onkeydown=function(t){n.keyMap.set(t.keyCode,!0)},document.onkeyup=function(t){n.keyMap.set(t.keyCode,!1)}}return t.prototype.initMouseControls=function(t){var e=this;t.onmousemove=function(n){var r,i=t.getBoundingClientRect(),o=new y(n.clientX-i.left,n.clientY-i.top);(r=o).x>=0&&r.x<=a.canvasWidth&&r.y>=0&&r.y<=a.canvasHeight&&(e.mouseCanvasCoords=o)},t.onmousedown=function(t){e.isMouseDownInternal=!0},t.onmouseup=function(t){e.isMouseDownInternal=!1},t.onclick=function(t){e.hasClickInternal=!0}},t.prototype.hasClick=function(){return this.hasClickInternal},t.prototype.handleClick=function(){if(!this.hasClick())throw new Error("Must check hasClick before handleClick, or click already handled.");return this.hasClickInternal=!1,this.mouseCanvasCoords},t.prototype.getMouseCanvasCoords=function(){return this.mouseCanvasCoords},t.prototype.isMouseDown=function(){return this.isMouseDownInternal},t.prototype.isKeyDown=function(t){var e=this.keyMap.get(t);if(null==e)throw new Error("Called isKeyDown for unmapped key: "+this.getStringForKey(t));return e},t.prototype.addAssignedControl=function(t,e){if(this.assignedControlMap.has(t))throw new Error("Double-bound a control: "+t);this.assignedControlMap.set(t,e),this.keyMap.has(t)||this.keyMap.set(t,!1)},t.prototype.removeAssignedControl=function(t){if(!this.assignedControlMap.has(t))throw new Error("Removing unassigned control");this.assignedControlMap.delete(t)},t.prototype.getAssignedControlMap=function(){return this.assignedControlMap},t.prototype.getStringForKey=function(t){switch(t){case x.SHIFT:return"Shift";case x.A:return"A";case x.B:return"B";case x.C:return"C";case x.D:return"D";case x.E:return"E";case x.F:return"F";case x.G:return"G";case x.H:return"H";case x.I:return"I";case x.J:return"J";case x.K:return"K";case x.L:return"L";case x.M:return"M";case x.N:return"N";case x.O:return"O";case x.P:return"P";case x.Q:return"Q";case x.R:return"R";case x.S:return"S";case x.T:return"T";case x.U:return"U";case x.V:return"V";case x.W:return"W";case x.X:return"X";case x.Y:return"Y";case x.Z:return"Z";case x.ONE:return"1";case x.TWO:return"2";case x.THREE:return"3";case x.FOUR:return"4";case x.FIVE:return"5";case x.SIX:return"6";case x.SEVEN:return"7";case x.EIGHT:return"8";case x.NINE:return"9";case x.ZERO:return"0";case x.SPACE:return"Space";case x.QUESTION_MARK:return"?";case x.LEFT_ARROW:return"Left arrow";case x.UP_ARROW:return"Up arrow";case x.RIGHT_ARROW:return"Right arrow";case x.DOWN_ARROW:return"Down arrow";default:throw new Error("Need to add string for Key")}},t}();!function(t){t[t.ENTER=13]="ENTER",t[t.SHIFT=16]="SHIFT",t[t.SPACE=32]="SPACE",t[t.LEFT_ARROW=37]="LEFT_ARROW",t[t.UP_ARROW=38]="UP_ARROW",t[t.RIGHT_ARROW=39]="RIGHT_ARROW",t[t.DOWN_ARROW=40]="DOWN_ARROW",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.ZERO=58]="ZERO",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.QUESTION_MARK=191]="QUESTION_MARK"}(x||(x={}));var g=new Map([[1,x.ONE],[2,x.TWO],[3,x.THREE],[4,x.FOUR],[5,x.FIVE],[6,x.SIX],[7,x.SEVEN],[8,x.EIGHT],[9,x.NINE]]),m=new Map([[1,"1st"],[2,"2nd"],[3,"3rd"],[4,"4th"],[5,"5th"],[6,"6th"],[7,"7th"],[8,"8th"],[9,"9th"]]),p=new f,T=new y(0,-1),v=new y(0,1),S=new y(-1,0),C=new y(1,0);var E=function(){function t(){}return t.getCanvasFromTileCoords=function(e){return new y(e.x*t.TILE_SIZE,e.y*t.TILE_SIZE)},t.getTileFromCanvasCoords=function(e){return new y(Math.floor(e.x/t.TILE_SIZE),Math.floor(e.y/t.TILE_SIZE))},t.inbounds=function(e){return e.x>=0&&e.x<t.TILES_WIDE&&e.y>=0&&e.y<t.TILES_TALL},t.getAdjacentTiles=function(e){var n=[],a=e.add(T),r=e.add(v),i=e.add(S),o=e.add(C);return t.inbounds(a)&&n.push(a),t.inbounds(r)&&n.push(r),t.inbounds(i)&&n.push(i),t.inbounds(o)&&n.push(o),n},t.BUTTON_PANE_WIDTH=240,t.BUTTON_PANE_HEIGHT=a.canvasHeight,t.GAME_WIDTH=a.canvasWidth-t.BUTTON_PANE_WIDTH,t.GAME_HEIGHT=a.canvasHeight,t.TILE_SIZE=40,t.TILES_WIDE=t.GAME_WIDTH/t.TILE_SIZE,t.TILES_TALL=t.GAME_HEIGHT/t.TILE_SIZE,t.HALF_TILE=new y(t.TILE_SIZE/2,t.TILE_SIZE/2),t}();function A(t){for(var e,n,a=t.startTile,r=t.maxDepth,o=t.isAvailable,l=t.canGoThrough,c=new Map,y=E.getAdjacentTiles(a).concat(a).map((function(t){return{depth:1,coords:t}}));y.length;){var h=y.shift();if(!(h.depth>r)&&l(h.coords)){o(h.coords)&&c.set(h.coords.toString(),h.coords);var u=function(t){if(s(c.values()).find((function(e){return e.equals(t)})))return"continue";y.push({depth:h.depth+1,coords:t})};try{for(var x=(e=void 0,i(E.getAdjacentTiles(h.coords))),d=x.next();!d.done;d=x.next()){u(d.value)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=x.return)&&n.call(x)}finally{if(e)throw e.error}}}}return s(c.values())}var I,w,L="#959aa3",M="#1560e8",b="#614447",R="#edb951",_="#0a0a0a88",P=!1,D="#4c6e47",F="#7a5f3e",k="#e34055",O="#3d7cd4",H="#e34055",N="#3d7cd4",G="#b05662",B="#547199",W="#000000",U="#b8b6a589",z="#d9d7bfa9",Z="#d90228bb",q="#e8e1d8",j="#00FF00",K="#FF0000",V="#474747",Y="#427cad",Q="#6392ba",X="#1068b0",J="#000000",$="#cfcfcf",tt="#c2c2c2",et="#959aa3",nt="#1560e8",at=[{name:"Diagonal",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:16,y:18},{x:16,y:17},{x:16,y:16},{x:17,y:16},{x:18,y:16},{x:1,y:3},{x:2,y:3},{x:3,y:3},{x:3,y:2},{x:3,y:1},{x:0,y:6},{x:1,y:6},{x:2,y:6},{x:3,y:6},{x:6,y:0},{x:6,y:1},{x:6,y:2},{x:6,y:3},{x:6,y:6},{x:6,y:7},{x:6,y:8},{x:6,y:9},{x:7,y:6},{x:8,y:6},{x:9,y:6},{x:13,y:19},{x:13,y:18},{x:13,y:17},{x:13,y:16},{x:19,y:13},{x:18,y:13},{x:17,y:13},{x:16,y:13},{x:13,y:13},{x:13,y:12},{x:13,y:11},{x:13,y:10},{x:12,y:13},{x:11,y:13},{x:10,y:13},{x:10,y:9},{x:10,y:10},{x:9,y:10},{x:9,y:9},{x:13,y:6},{x:13,y:5},{x:13,y:4},{x:14,y:6},{x:15,y:6},{x:6,y:13},{x:6,y:14},{x:6,y:15},{x:5,y:13},{x:4,y:13},{x:3,y:16},{x:2,y:16},{x:2,y:17},{x:3,y:17},{x:16,y:3},{x:16,y:2},{x:17,y:2},{x:17,y:3},{x:3,y:9},{x:3,y:10},{x:9,y:3},{x:10,y:3},{x:10,y:16},{x:9,y:16},{x:16,y:10},{x:16,y:9},{x:17,y:10},{x:10,y:17},{x:2,y:9},{x:9,y:2},{x:6,y:19},{x:6,y:18},{x:1,y:13},{x:0,y:13},{x:13,y:1},{x:13,y:0},{x:18,y:6},{x:19,y:6}]},aiSpawner:{x:1,y:18}},{name:"Horizontal",data:{redFlag:{x:10,y:19},blueFlag:{x:9,y:0},obstacles:[{x:2,y:17},{x:3,y:17},{x:5,y:17},{x:6,y:17},{x:7,y:17},{x:10,y:17},{x:13,y:17},{x:14,y:17},{x:17,y:17},{x:8,y:17},{x:9,y:17},{x:11,y:17},{x:12,y:17},{x:16,y:17},{x:17,y:2},{x:16,y:2},{x:14,y:2},{x:13,y:2},{x:12,y:2},{x:11,y:2},{x:10,y:2},{x:9,y:2},{x:8,y:2},{x:7,y:2},{x:6,y:2},{x:5,y:2},{x:3,y:2},{x:2,y:2},{x:3,y:5},{x:4,y:5},{x:5,y:5},{x:14,y:5},{x:15,y:5},{x:16,y:5},{x:14,y:15},{x:15,y:15},{x:16,y:15},{x:4,y:15},{x:5,y:15},{x:3,y:15},{x:6,y:15},{x:13,y:15},{x:13,y:5},{x:6,y:5},{x:1,y:9},{x:1,y:10},{x:0,y:9},{x:1,y:8},{x:19,y:9},{x:18,y:9},{x:18,y:8},{x:18,y:10},{x:2,y:8},{x:17,y:8},{x:18,y:11},{x:1,y:11},{x:4,y:11},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:8,y:12},{x:11,y:12},{x:11,y:11},{x:12,y:11},{x:13,y:11},{x:15,y:11},{x:14,y:11},{x:9,y:9},{x:10,y:9},{x:11,y:9},{x:8,y:9},{x:9,y:15},{x:10,y:15},{x:9,y:5},{x:10,y:5},{x:8,y:7},{x:7,y:7},{x:6,y:7},{x:11,y:7},{x:12,y:7},{x:13,y:7}]},aiSpawner:{x:10,y:18}},{name:"Paths",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:1},{x:17,y:2},{x:18,y:2},{x:1,y:17},{x:2,y:17},{x:2,y:18},{x:1,y:16},{x:3,y:18},{x:16,y:1},{x:18,y:3},{x:16,y:5},{x:15,y:6},{x:14,y:7},{x:13,y:8},{x:14,y:3},{x:13,y:4},{x:12,y:5},{x:11,y:6},{x:10,y:7},{x:10,y:6},{x:11,y:5},{x:12,y:4},{x:13,y:3},{x:14,y:8},{x:15,y:7},{x:16,y:6},{x:13,y:9},{x:12,y:9},{x:3,y:14},{x:5,y:16},{x:6,y:16},{x:3,y:13},{x:4,y:13},{x:6,y:15},{x:7,y:15},{x:7,y:14},{x:4,y:12},{x:8,y:14},{x:8,y:13},{x:5,y:12},{x:5,y:11},{x:6,y:11},{x:6,y:10},{x:9,y:13},{x:9,y:12},{x:7,y:10},{x:9,y:10},{x:9,y:9},{x:10,y:9},{x:10,y:10},{x:16,y:9},{x:7,y:7},{x:7,y:6},{x:6,y:6},{x:6,y:5},{x:5,y:5},{x:12,y:12},{x:12,y:13},{x:13,y:13},{x:13,y:14},{x:14,y:14},{x:14,y:15},{x:15,y:15},{x:5,y:4},{x:4,y:4},{x:15,y:18},{x:16,y:18},{x:16,y:17},{x:17,y:17},{x:17,y:16},{x:18,y:16},{x:18,y:15},{x:2,y:2},{x:3,y:2},{x:3,y:1},{x:4,y:1},{x:2,y:3},{x:1,y:3},{x:1,y:4},{x:16,y:10},{x:17,y:11},{x:16,y:12},{x:16,y:13},{x:3,y:6},{x:3,y:7},{x:2,y:8},{x:3,y:9},{x:3,y:10},{x:18,y:9},{x:19,y:9},{x:19,y:8},{x:0,y:10},{x:1,y:10},{x:1,y:11},{x:8,y:4},{x:7,y:3},{x:10,y:3},{x:11,y:2},{x:12,y:1},{x:6,y:2},{x:11,y:15},{x:12,y:16},{x:13,y:17},{x:9,y:16},{x:8,y:17},{x:7,y:18},{x:9,y:0},{x:10,y:19}]},aiSpawner:{x:1,y:18}},{name:"Symmetry",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:16,y:1},{x:16,y:2},{x:16,y:3},{x:17,y:3},{x:18,y:3},{x:13,y:0},{x:13,y:1},{x:13,y:3},{x:13,y:2},{x:15,y:6},{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:19,y:6},{x:12,y:7},{x:13,y:8},{x:11,y:6},{x:11,y:5},{x:11,y:4},{x:11,y:3},{x:11,y:2},{x:14,y:8},{x:15,y:8},{x:16,y:8},{x:17,y:8},{x:19,y:10},{x:17,y:10},{x:18,y:10},{x:16,y:10},{x:14,y:10},{x:15,y:10},{x:13,y:10},{x:10,y:9},{x:10,y:10},{x:9,y:10},{x:9,y:9},{x:7,y:12},{x:8,y:13},{x:8,y:14},{x:8,y:15},{x:8,y:16},{x:8,y:17},{x:6,y:11},{x:5,y:11},{x:4,y:11},{x:2,y:11},{x:3,y:11},{x:0,y:13},{x:1,y:13},{x:2,y:13},{x:3,y:13},{x:4,y:13},{x:6,y:15},{x:6,y:16},{x:6,y:17},{x:6,y:18},{x:6,y:19},{x:3,y:16},{x:2,y:16},{x:1,y:16},{x:3,y:17},{x:3,y:18},{x:10,y:13},{x:10,y:14},{x:10,y:15},{x:10,y:16},{x:10,y:17},{x:10,y:18},{x:10,y:19},{x:11,y:11},{x:12,y:12},{x:13,y:13},{x:14,y:14},{x:12,y:13},{x:13,y:12},{x:13,y:14},{x:14,y:13},{x:13,y:15},{x:13,y:16},{x:14,y:16},{x:15,y:16},{x:15,y:15},{x:16,y:16},{x:16,y:15},{x:16,y:14},{x:15,y:14},{x:15,y:13},{x:16,y:13},{x:14,y:15},{x:16,y:17},{x:17,y:17},{x:17,y:16},{x:8,y:8},{x:7,y:7},{x:6,y:7},{x:6,y:6},{x:7,y:6},{x:6,y:5},{x:6,y:4},{x:6,y:3},{x:5,y:3},{x:4,y:3},{x:3,y:3},{x:3,y:4},{x:3,y:5},{x:3,y:6},{x:4,y:6},{x:5,y:6},{x:5,y:4},{x:4,y:4},{x:5,y:5},{x:4,y:5},{x:3,y:2},{x:2,y:3},{x:2,y:2},{x:0,y:0},{x:19,y:19},{x:13,y:19},{x:19,y:13},{x:6,y:0},{x:0,y:6},{x:6,y:9},{x:5,y:9},{x:4,y:9},{x:3,y:9},{x:1,y:9},{x:2,y:9},{x:0,y:9},{x:9,y:6},{x:9,y:5},{x:9,y:4},{x:9,y:3},{x:9,y:2},{x:9,y:1},{x:9,y:0}]},aiSpawner:{x:2,y:17}},{name:"Squares",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:2},{x:16,y:2},{x:16,y:3},{x:17,y:3},{x:12,y:7},{x:8,y:10},{x:8,y:11},{x:9,y:11},{x:1,y:17},{x:2,y:18},{x:2,y:17},{x:16,y:1},{x:17,y:1},{x:18,y:2},{x:18,y:3},{x:1,y:16},{x:2,y:16},{x:3,y:16},{x:3,y:17},{x:3,y:18},{x:5,y:14},{x:5,y:13},{x:5,y:12},{x:6,y:12},{x:7,y:12},{x:7,y:13},{x:7,y:14},{x:6,y:14},{x:6,y:13},{x:10,y:8},{x:11,y:9},{x:11,y:8},{x:12,y:6},{x:13,y:7},{x:13,y:6},{x:13,y:5},{x:14,y:5},{x:14,y:6},{x:14,y:7},{x:12,y:5},{x:12,y:12},{x:12,y:13},{x:12,y:14},{x:13,y:14},{x:14,y:14},{x:14,y:13},{x:14,y:12},{x:13,y:12},{x:13,y:13},{x:13,y:9},{x:13,y:10},{x:14,y:10},{x:14,y:9},{x:9,y:13},{x:9,y:14},{x:10,y:14},{x:10,y:13},{x:15,y:12},{x:15,y:13},{x:15,y:14},{x:15,y:15},{x:14,y:15},{x:13,y:15},{x:12,y:15},{x:13,y:17},{x:14,y:17},{x:14,y:18},{x:13,y:18},{x:17,y:13},{x:17,y:14},{x:18,y:14},{x:18,y:13},{x:17,y:17},{x:17,y:18},{x:18,y:18},{x:18,y:17},{x:7,y:7},{x:7,y:6},{x:7,y:5},{x:7,y:4},{x:4,y:4},{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:5,y:7},{x:6,y:7},{x:6,y:6},{x:5,y:6},{x:6,y:5},{x:5,y:5},{x:5,y:4},{x:6,y:4},{x:5,y:9},{x:6,y:9},{x:6,y:10},{x:5,y:10},{x:9,y:6},{x:10,y:6},{x:10,y:5},{x:9,y:5},{x:6,y:2},{x:6,y:1},{x:5,y:1},{x:5,y:2},{x:2,y:5},{x:1,y:5},{x:1,y:6},{x:2,y:6},{x:2,y:2},{x:1,y:2},{x:1,y:1},{x:2,y:1},{x:9,y:2},{x:10,y:2},{x:10,y:1},{x:9,y:1},{x:17,y:9},{x:17,y:10},{x:18,y:10},{x:18,y:9},{x:2,y:9},{x:1,y:9},{x:1,y:10},{x:2,y:10},{x:9,y:17},{x:10,y:17},{x:10,y:18},{x:9,y:18},{x:16,y:5},{x:17,y:6},{x:18,y:7},{x:12,y:1},{x:13,y:2},{x:14,y:3},{x:1,y:12},{x:2,y:13},{x:3,y:14},{x:5,y:16},{x:6,y:17},{x:7,y:18},{x:5,y:19},{x:0,y:14},{x:19,y:5},{x:14,y:0},{x:9,y:10},{x:10,y:9}]},aiSpawner:{x:1,y:18}},{name:"Corners",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:1},{x:18,y:2},{x:14,y:1},{x:15,y:1},{x:15,y:2},{x:18,y:4},{x:17,y:4},{x:18,y:5},{x:15,y:4},{x:14,y:4},{x:15,y:5},{x:12,y:7},{x:11,y:7},{x:12,y:8},{x:4,y:14},{x:4,y:15},{x:5,y:15},{x:1,y:17},{x:2,y:18},{x:1,y:15},{x:1,y:14},{x:2,y:15},{x:4,y:18},{x:4,y:17},{x:5,y:18},{x:7,y:12},{x:7,y:11},{x:8,y:12},{x:9,y:9},{x:10,y:10},{x:15,y:16},{x:16,y:15},{x:18,y:19},{x:19,y:18},{x:16,y:16},{x:19,y:19},{x:3,y:3},{x:3,y:4},{x:4,y:3},{x:0,y:1},{x:0,y:0},{x:1,y:0},{x:19,y:16},{x:18,y:16},{x:19,y:15},{x:15,y:19},{x:16,y:19},{x:16,y:18},{x:0,y:3},{x:0,y:4},{x:1,y:3},{x:3,y:6},{x:3,y:7},{x:4,y:7},{x:15,y:12},{x:16,y:12},{x:16,y:13},{x:13,y:16},{x:12,y:16},{x:12,y:15},{x:13,y:18},{x:12,y:18},{x:12,y:19},{x:18,y:13},{x:18,y:12},{x:19,y:12},{x:3,y:1},{x:3,y:0},{x:4,y:0},{x:0,y:7},{x:1,y:7},{x:1,y:6},{x:6,y:1},{x:7,y:1},{x:7,y:0},{x:7,y:3},{x:6,y:3},{x:7,y:4},{x:7,y:6},{x:6,y:7},{x:12,y:13},{x:13,y:12},{x:6,y:6},{x:13,y:13},{x:15,y:10},{x:16,y:10},{x:15,y:9},{x:18,y:10},{x:19,y:10},{x:19,y:9},{x:0,y:10},{x:0,y:9},{x:1,y:9},{x:3,y:9},{x:4,y:9},{x:4,y:10},{x:7,y:15},{x:8,y:15},{x:8,y:14},{x:7,y:17},{x:8,y:17},{x:8,y:18},{x:12,y:2},{x:11,y:2},{x:11,y:1},{x:11,y:4},{x:12,y:4},{x:11,y:5},{x:16,y:7},{x:17,y:7},{x:17,y:8},{x:2,y:11},{x:2,y:12},{x:3,y:12},{x:10,y:13},{x:9,y:6},{x:9,y:3},{x:10,y:16}]},aiSpawner:{x:1,y:18}},{name:"Spotted",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:1,y:1},{x:2,y:2},{x:3,y:3},{x:9,y:9},{x:10,y:10},{x:11,y:11},{x:17,y:17},{x:18,y:18},{x:8,y:8},{x:16,y:16},{x:10,y:9},{x:11,y:8},{x:9,y:10},{x:8,y:11},{x:6,y:13},{x:5,y:14},{x:13,y:6},{x:14,y:5},{x:16,y:3},{x:17,y:2},{x:3,y:16},{x:2,y:17},{x:1,y:17},{x:2,y:18},{x:18,y:2},{x:17,y:1},{x:13,y:5},{x:14,y:6},{x:5,y:13},{x:6,y:14},{x:8,y:16},{x:9,y:17},{x:11,y:19},{x:3,y:11},{x:2,y:10},{x:0,y:8},{x:0,y:7},{x:12,y:19},{x:11,y:3},{x:10,y:2},{x:16,y:8},{x:17,y:9},{x:19,y:11},{x:19,y:12},{x:8,y:0},{x:7,y:0},{x:13,y:13},{x:14,y:14},{x:6,y:6},{x:5,y:5},{x:4,y:7},{x:3,y:8},{x:7,y:4},{x:8,y:3},{x:8,y:4},{x:7,y:3},{x:4,y:8},{x:3,y:7},{x:12,y:15},{x:11,y:15},{x:11,y:16},{x:12,y:16},{x:15,y:12},{x:16,y:12},{x:16,y:11},{x:15,y:11},{x:13,y:10},{x:10,y:13},{x:6,y:9},{x:9,y:6},{x:2,y:1},{x:1,y:2},{x:2,y:3},{x:3,y:2},{x:16,y:17},{x:17,y:18},{x:18,y:17},{x:17,y:16},{x:1,y:7},{x:12,y:18},{x:18,y:12},{x:7,y:1},{x:5,y:18},{x:6,y:19},{x:1,y:14},{x:0,y:13},{x:18,y:5},{x:19,y:6},{x:13,y:1},{x:12,y:0},{x:0,y:5},{x:0,y:6},{x:1,y:6},{x:18,y:13},{x:19,y:14},{x:19,y:13},{x:6,y:0},{x:6,y:1},{x:5,y:0},{x:13,y:18},{x:13,y:19},{x:14,y:19}]},aiSpawner:{x:1,y:18}},{name:"Entropy",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:16,y:3},{x:15,y:5},{x:16,y:7},{x:13,y:5},{x:11,y:3},{x:5,y:4},{x:5,y:7},{x:10,y:10},{x:11,y:11},{x:8,y:3},{x:11,y:6},{x:14,y:9},{x:13,y:10},{x:8,y:6},{x:7,y:6},{x:6,y:11},{x:6,y:13},{x:3,y:11},{x:2,y:5},{x:5,y:5},{x:9,y:10},{x:10,y:14},{x:4,y:10},{x:3,y:8},{x:0,y:10},{x:2,y:14},{x:6,y:15},{x:6,y:18},{x:3,y:18},{x:1,y:16},{x:0,y:17},{x:5,y:18},{x:4,y:14},{x:4,y:13},{x:4,y:17},{x:12,y:16},{x:13,y:13},{x:10,y:17},{x:8,y:17},{x:8,y:13},{x:11,y:14},{x:11,y:16},{x:9,y:19},{x:16,y:18},{x:14,y:14},{x:15,y:16},{x:14,y:18},{x:18,y:15},{x:16,y:12},{x:18,y:13},{x:15,y:13},{x:15,y:11},{x:16,y:10},{x:10,y:7},{x:8,y:8},{x:7,y:11},{x:7,y:7},{x:12,y:8},{x:13,y:9},{x:15,y:9},{x:19,y:7},{x:18,y:8},{x:17,y:5},{x:17,y:2},{x:17,y:1},{x:13,y:1},{x:11,y:2},{x:13,y:3},{x:11,y:1},{x:8,y:1},{x:7,y:2},{x:4,y:1},{x:4,y:0},{x:2,y:1},{x:2,y:3},{x:0,y:4},{x:1,y:7},{x:1,y:9},{x:2,y:10},{x:1,y:12},{x:6,y:14},{x:12,y:14},{x:14,y:17},{x:8,y:16},{x:7,y:13},{x:10,y:11},{x:4,y:6},{x:3,y:9},{x:5,y:8},{x:6,y:4},{x:12,y:5},{x:17,y:3},{x:19,y:6},{x:19,y:8},{x:18,y:14},{x:19,y:14},{x:17,y:18},{x:15,y:18},{x:13,y:18},{x:1,y:13},{x:0,y:0},{x:13,y:0},{x:7,y:8},{x:8,y:9},{x:9,y:9},{x:11,y:12},{x:13,y:14},{x:15,y:12},{x:15,y:14},{x:16,y:11},{x:16,y:9},{x:10,y:6},{x:11,y:5},{x:14,y:16},{x:10,y:16},{x:3,y:10},{x:0,y:9},{x:2,y:9},{x:3,y:6}]},aiSpawner:{x:1,y:18}},{name:"Sliced",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:17,y:2},{x:16,y:3},{x:14,y:5},{x:15,y:4},{x:2,y:17},{x:3,y:16},{x:4,y:15},{x:5,y:14},{x:2,y:13},{x:3,y:12},{x:4,y:11},{x:5,y:10},{x:13,y:2},{x:12,y:3},{x:11,y:4},{x:10,y:5},{x:7,y:12},{x:8,y:11},{x:9,y:10},{x:10,y:9},{x:11,y:8},{x:12,y:7},{x:6,y:17},{x:7,y:16},{x:8,y:15},{x:9,y:14},{x:17,y:6},{x:16,y:7},{x:15,y:8},{x:14,y:9},{x:6,y:6},{x:5,y:7},{x:4,y:8},{x:3,y:9},{x:7,y:5},{x:8,y:4},{x:9,y:3},{x:13,y:13},{x:14,y:12},{x:15,y:11},{x:16,y:10},{x:12,y:14},{x:11,y:15},{x:10,y:16},{x:11,y:11},{x:11,y:12},{x:12,y:11},{x:7,y:8},{x:8,y:8},{x:8,y:7},{x:10,y:19},{x:11,y:18},{x:12,y:17},{x:13,y:16},{x:15,y:14},{x:16,y:13},{x:17,y:12},{x:18,y:11},{x:9,y:0},{x:8,y:1},{x:7,y:2},{x:6,y:3},{x:4,y:5},{x:3,y:6},{x:2,y:7},{x:1,y:8},{x:15,y:17},{x:16,y:16},{x:4,y:2},{x:3,y:3},{x:3,y:0},{x:2,y:1},{x:1,y:2},{x:16,y:19},{x:17,y:18},{x:18,y:17},{x:0,y:12},{x:1,y:11},{x:18,y:9},{x:19,y:8},{x:6,y:19},{x:2,y:19},{x:17,y:0},{x:13,y:0},{x:0,y:6},{x:1,y:5},{x:18,y:14},{x:19,y:13},{x:19,y:5},{x:18,y:4},{x:1,y:15},{x:0,y:14}]},aiSpawner:{x:1,y:18}},{name:"Pockets",data:{redFlag:{x:10,y:19},blueFlag:{x:10,y:0},obstacles:[{x:7,y:1},{x:7,y:2},{x:7,y:3},{x:7,y:4},{x:8,y:4},{x:9,y:4},{x:10,y:4},{x:11,y:4},{x:12,y:4},{x:13,y:4},{x:13,y:3},{x:13,y:2},{x:13,y:1},{x:7,y:17},{x:7,y:18},{x:7,y:16},{x:7,y:15},{x:8,y:15},{x:9,y:15},{x:10,y:15},{x:12,y:15},{x:11,y:15},{x:13,y:15},{x:13,y:16},{x:13,y:17},{x:13,y:18},{x:7,y:8},{x:6,y:8},{x:5,y:8},{x:4,y:8},{x:5,y:13},{x:5,y:12},{x:5,y:11},{x:6,y:11},{x:7,y:11},{x:8,y:11},{x:9,y:11},{x:9,y:12},{x:9,y:13},{x:12,y:11},{x:12,y:13},{x:12,y:12},{x:13,y:11},{x:14,y:11},{x:15,y:11},{x:16,y:11},{x:16,y:12},{x:16,y:13},{x:3,y:11},{x:2,y:11},{x:1,y:11},{x:3,y:12},{x:3,y:13},{x:3,y:14},{x:3,y:15},{x:3,y:16},{x:3,y:17},{x:2,y:17},{x:1,y:17},{x:17,y:2},{x:18,y:2},{x:16,y:2},{x:16,y:3},{x:16,y:4},{x:16,y:5},{x:16,y:6},{x:16,y:7},{x:16,y:8},{x:17,y:8},{x:18,y:8},{x:14,y:6},{x:14,y:7},{x:14,y:8},{x:13,y:8},{x:12,y:8},{x:11,y:8},{x:10,y:8},{x:10,y:7},{x:10,y:6},{x:7,y:7},{x:7,y:6},{x:3,y:8},{x:3,y:7},{x:3,y:6},{x:18,y:18},{x:17,y:18},{x:16,y:18},{x:16,y:17},{x:16,y:16},{x:16,y:15},{x:17,y:15},{x:18,y:15},{x:3,y:4},{x:4,y:4},{x:4,y:1},{x:3,y:1},{x:2,y:1},{x:2,y:4},{x:4,y:2},{x:4,y:3},{x:1,y:1},{x:1,y:4},{x:0,y:7},{x:0,y:8},{x:19,y:11},{x:19,y:12},{x:19,y:13},{x:0,y:6},{x:0,y:19},{x:19,y:0}]},aiSpawner:{x:10,y:16}},{name:"Raid",data:{redFlag:{x:1,y:14},blueFlag:{x:5,y:18},obstacles:[{x:2,y:15},{x:3,y:15},{x:3,y:16},{x:3,y:17},{x:3,y:18},{x:2,y:19},{x:2,y:18},{x:2,y:17},{x:2,y:16},{x:1,y:16},{x:0,y:17},{x:1,y:17},{x:1,y:18},{x:0,y:19},{x:4,y:15},{x:3,y:14},{x:4,y:14},{x:4,y:16},{x:3,y:13},{x:4,y:13},{x:3,y:12},{x:4,y:12},{x:3,y:11},{x:4,y:11},{x:5,y:11},{x:5,y:12},{x:5,y:13},{x:6,y:14},{x:5,y:14},{x:5,y:15},{x:5,y:16},{x:4,y:17},{x:6,y:15},{x:6,y:16},{x:7,y:14},{x:8,y:14},{x:9,y:14},{x:9,y:15},{x:9,y:16},{x:7,y:16},{x:8,y:16},{x:8,y:15},{x:7,y:15},{x:0,y:18},{x:1,y:19},{x:4,y:10},{x:5,y:10},{x:5,y:9},{x:10,y:15},{x:10,y:14},{x:11,y:14},{x:10,y:12},{x:11,y:11},{x:12,y:10},{x:13,y:9},{x:10,y:11},{x:11,y:10},{x:12,y:9},{x:7,y:9},{x:8,y:8},{x:9,y:7},{x:10,y:6},{x:9,y:8},{x:8,y:9},{x:10,y:7},{x:11,y:6},{x:11,y:5},{x:14,y:8},{x:13,y:8},{x:7,y:12},{x:7,y:13},{x:6,y:13},{x:6,y:12},{x:13,y:6},{x:13,y:5},{x:14,y:6},{x:15,y:4},{x:15,y:3},{x:16,y:4},{x:16,y:1},{x:17,y:2},{x:18,y:3},{x:18,y:2},{x:17,y:1},{x:12,y:3},{x:13,y:3},{x:13,y:2},{x:12,y:2},{x:16,y:6},{x:16,y:7},{x:17,y:7},{x:17,y:6},{x:3,y:7},{x:4,y:6},{x:5,y:5},{x:6,y:4},{x:7,y:3},{x:8,y:2},{x:3,y:10},{x:4,y:9},{x:5,y:8},{x:3,y:6},{x:4,y:5},{x:5,y:4},{x:6,y:3},{x:7,y:2},{x:14,y:15},{x:15,y:14},{x:16,y:13},{x:17,y:12},{x:13,y:16},{x:12,y:16},{x:13,y:15},{x:14,y:14},{x:15,y:13},{x:16,y:12},{x:17,y:11},{x:2,y:3},{x:2,y:2},{x:2,y:1},{x:3,y:1},{x:4,y:1},{x:3,y:2},{x:1,y:4},{x:1,y:3},{x:1,y:2},{x:1,y:1},{x:18,y:18},{x:17,y:18},{x:16,y:18},{x:15,y:18},{x:18,y:17},{x:18,y:16},{x:18,y:15},{x:17,y:16},{x:16,y:17},{x:17,y:17},{x:8,y:11},{x:7,y:11},{x:8,y:12}]},aiSpawner:{x:1,y:13}},{name:"Arena",data:{redFlag:{x:0,y:19},blueFlag:{x:19,y:0},obstacles:[{x:1,y:14},{x:2,y:14},{x:2,y:15},{x:3,y:15},{x:3,y:16},{x:4,y:16},{x:4,y:17},{x:5,y:17},{x:5,y:18},{x:0,y:9},{x:1,y:9},{x:1,y:10},{x:2,y:10},{x:2,y:11},{x:10,y:19},{x:10,y:18},{x:9,y:18},{x:9,y:17},{x:8,y:17},{x:16,y:3},{x:16,y:4},{x:15,y:3},{x:17,y:4},{x:17,y:5},{x:18,y:5},{x:15,y:2},{x:14,y:2},{x:14,y:1},{x:17,y:8},{x:17,y:9},{x:18,y:9},{x:18,y:10},{x:19,y:10},{x:11,y:2},{x:10,y:2},{x:10,y:1},{x:9,y:1},{x:9,y:0},{x:6,y:9},{x:6,y:12},{x:9,y:6},{x:12,y:6},{x:7,y:13},{x:13,y:7},{x:14,y:14},{x:15,y:15},{x:16,y:16},{x:17,y:17},{x:5,y:5},{x:4,y:4},{x:3,y:3},{x:2,y:2},{x:10,y:13},{x:13,y:10}]},aiSpawner:{x:1,y:18}}];!function(t){t[t.PLAYER_VS_PLAYER_LOCAL=0]="PLAYER_VS_PLAYER_LOCAL",t[t.PLAYER_VS_AI=1]="PLAYER_VS_AI",t[t.AI_VS_AI=2]="AI_VS_AI"}(I||(I={})),function(t){t.WEAK="Weak",t.MEDIUM="Medium",t.STRONG="Strong"}(w||(w={}));I.PLAYER_VS_PLAYER_LOCAL,new Map([[0,4],[1,4]]),w.WEAK;var rt=8,it=2,ot=function(){function t(t,e){this.startPt=t,this.direction=e}return t.prototype.pointAtDistance=function(t){return this.startPt.add(this.direction.multiplyScaler(t))},t}(),st=function(t,e,n){this.startPt=t,this.endPt=e,this.normal=n};var lt=function(){function t(t,e){this.m=t,this.b=e}return t.from=function(e,n){var a=(n.y-e.y)/(n.x-e.x);return new t(a,-a*e.x+e.y)},t.prototype.isVertical=function(){return!isFinite(this.m)},t.prototype.getYvalueAtX=function(t){return this.m*t+this.b},t}();function ct(t,e){var n=t.startPt,a=t.direction,r=a.getNormalVectorClockwise(),i=e.startPt,o=e.endPt,s=i.subtract(n),l=o.subtract(n);if(!function(t,e){if(t>0&&e<0||t<0&&e>0)return!0;return xt(t)&&!xt(e)||xt(e)&&!xt(t)}(r.dot(s),r.dot(l)))return{isCollision:!1};var c,h=lt.from(t.startPt,t.startPt.add(t.direction)),u=lt.from(e.startPt,e.endPt);if(u.isVertical()){var x=h.getYvalueAtX(i.x);c=new y(i.x,x)}else if(h.isVertical()){x=u.getYvalueAtX(n.x);c=new y(n.x,x)}else{var d=(u.b-h.b)/(h.m-u.m),f=h.getYvalueAtX(d);c=new y(d,f)}var g=c.subtract(n);return a.dot(g)<0?{isCollision:!1}:{isCollision:!0,collisionPt:c}}var yt,ht,ut;function xt(t){return Math.abs(t)<1e-6}!function(t){t[t.BULLET=0]="BULLET",t[t.SPLASH=1]="SPLASH"}(yt||(yt={})),function(t){t.CIRCLE="Circle",t.RECTANGLE="Rectangle"}(ht||(ht={})),function(t){t.SELECT_CHARACTER_CLASS="SELECT_CHARACTER_CLASS",t.SELECT_TILE="SELECT_TILE",t.SELECT_CHARACTER="SELECT_CHARACTER",t.SELECT_CHARACTER_STATE="SELECT_CHARACTER_STATE",t.AIM="AIM",t.SHOOT="SHOOT",t.HEAL="HEAL",t.END_CHARACTER_TURN="END_CHARACTER_TURN"}(ut||(ut={}));var dt,ft;!function(t){t[t.HEAL=0]="HEAL",t[t.THROW_GRENADE=1]="THROW_GRENADE"}(dt||(dt={})),function(t){t.SCOUT="Scout",t.ASSAULT="Assault",t.SNIPER="Sniper",t.DEMOLITION="Demolition"}(ft||(ft={}));var gt,mt={abilityType:dt.HEAL,healAmount:3,maxUses:2,cooldownTurns:2,isFree:!0},pt={abilityType:dt.HEAL,healAmount:5,maxUses:2,cooldownTurns:3,isFree:!1},Tt={abilityType:dt.HEAL,healAmount:15,maxUses:1,cooldownTurns:0,isFree:!1},vt={abilityType:dt.THROW_GRENADE,splashDamage:{type:yt.SPLASH,numRicochets:0,damage:5,damageManhattanDistanceRadius:1,tilesAwayDamageReduction:.6,projectileSpeed:E.TILE_SIZE/160,color:"#176107",shape:{type:ht.CIRCLE,radius:E.TILE_SIZE/6}},maxManhattanDistance:4,maxUses:1,cooldownTurns:0,isFree:!1},St={abilityType:dt.THROW_GRENADE,splashDamage:{type:yt.SPLASH,numRicochets:0,damage:8,damageManhattanDistanceRadius:3,tilesAwayDamageReduction:.5,projectileSpeed:E.TILE_SIZE/160,color:"#176107",shape:{type:ht.CIRCLE,radius:E.TILE_SIZE/6}},maxManhattanDistance:4,maxUses:1,cooldownTurns:0,isFree:!1},Ct={canFireAfterMoving:!0,projectileDetails:{type:yt.BULLET,numRicochets:1,damage:3,projectileSpeed:E.TILE_SIZE/80,color:"#fff86e",shape:{type:ht.CIRCLE,radius:E.TILE_SIZE/16}},aimIndicatorLength:.75*E.TILE_SIZE,spray:{projectiles:3,offsetAngleRadians:Math.PI/24}},Et={canFireAfterMoving:!0,projectileDetails:{type:yt.BULLET,numRicochets:2,damage:6,projectileSpeed:E.TILE_SIZE/80,color:"#fff86e",shape:{type:ht.CIRCLE,radius:E.TILE_SIZE/12}},aimIndicatorLength:1.5*E.TILE_SIZE},At={canFireAfterMoving:!1,projectileDetails:{type:yt.BULLET,numRicochets:5,damage:8,projectileSpeed:E.TILE_SIZE/60,color:"#fff86e",shape:{type:ht.RECTANGLE,size:new y(E.TILE_SIZE/4,E.TILE_SIZE/8)}},aimIndicatorLength:12*E.TILE_SIZE},It={canFireAfterMoving:!0,projectileDetails:{type:yt.SPLASH,numRicochets:0,damage:10,damageManhattanDistanceRadius:2,tilesAwayDamageReduction:.6,projectileSpeed:E.TILE_SIZE/160,color:"#f2ebeb",shape:{type:ht.RECTANGLE,size:new y(E.TILE_SIZE/4,E.TILE_SIZE/8)}},aimIndicatorLength:.75*E.TILE_SIZE},wt={type:ft.SCOUT,maxHealth:8,maxMovesPerTurn:6,maxSight:8,gun:Ct,extraActions:new Set([mt,vt])},Lt={type:ft.ASSAULT,maxHealth:12,maxMovesPerTurn:4,maxSight:6,gun:Et,extraActions:new Set([pt,vt])},Mt=[wt,Lt,{type:ft.SNIPER,maxHealth:8,maxSight:8,maxMovesPerTurn:3,gun:At,extraActions:new Set([Tt])},{type:ft.DEMOLITION,maxHealth:12,maxSight:4,maxMovesPerTurn:3,gun:It,extraActions:new Set([Tt,St])}],bt=function(){function t(t){var e=t.tileCoords,n=t.teamIndex;this.startTileCoords=e,this.tileCoords=e,this.teamIndex=n}return t.prototype.setIsTaken=function(t){this.isTaken=!0,this.getTileTopLeft=t},t.prototype.isAtStart=function(){return this.startTileCoords.equals(this.tileCoords)},t.prototype.returnToStart=function(){this.setDropped(),this.tileCoords=this.startTileCoords},t.prototype.setDropped=function(){this.isTaken=!1,this.getTileTopLeft=void 0},t.prototype.getCurrentTile=function(){return this.isTaken?E.getTileFromCanvasCoords(this.getTileTopLeft()):this.tileCoords},t.prototype.update=function(t){},t.prototype.render=function(t){var e=E.getCanvasFromTileCoords(this.tileCoords);this.isTaken&&(e=this.getTileTopLeft());var n=.2*E.TILE_SIZE,a=.1*E.TILE_SIZE,r=a;t.fillStyle=F,t.fillRect(e.x+a,e.y+n,r,E.TILE_SIZE-n);var i=a,o=.36*E.TILE_SIZE;t.fillStyle=0===this.teamIndex?O:k,t.fillRect(e.x+a+r,e.y+n,E.TILE_SIZE-a-r-i,o)},t}(),Rt=3*E.TILE_SIZE,_t=2*Math.PI,Pt=function(){function t(t){if(this.context=t.context,this.projectileDetails=t.projectileDetails,0===t.targets.length)throw new Error("Created a projectile with no targets");this.setNewTargets(t.targets),this.tileCoords=E.getTileFromCanvasCoords(this.animationState.currentTarget.ray.startPt),this.trails=[{ray:this.animationState.currentTarget.ray,distance:0,maxDistance:this.animationState.currentTarget.maxDistance}],this.fromTeamIndex=t.fromTeamIndex,this.timesRicocheted=0,this.isDead=!1}return t.prototype.update=function(t){var e,n,a=this.animationState.currentTarget,r=a.ray.direction.multiplyScaler(this.animationState.movementSpeedMs*t),o=r.getMagnitude();try{for(var s=i(this.trails),l=s.next();!l.done;l=s.next()){l.value.distance+=o}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}this.animationState.isAnimating&&(this.animationState.currentCenterCanvas=this.animationState.currentCenterCanvas.add(r),this.tileCoords=E.getTileFromCanvasCoords(this.animationState.currentCenterCanvas),a.ray.startPt.distanceTo(this.animationState.currentCenterCanvas)<a.maxDistance||(this.animationState.currentCenterCanvas=this.animationState.currentTarget.canvasCoords,0!==this.animationState.remainingTargets.length?(this.animationState.currentTarget=this.animationState.remainingTargets.shift(),this.trails.push({ray:this.animationState.currentTarget.ray,distance:0,maxDistance:this.animationState.currentTarget.maxDistance}),this.timesRicocheted+=1):this.animationState.isAnimating=!1))},t.prototype.isAtFinalTarget=function(){return!this.isDead&&!this.animationState.isAnimating},t.prototype.setNewTargets=function(t){var e=t.shift(),n=t,a=null!=this.animationState?this.animationState.currentCenterCanvas:e.ray.startPt;this.animationState={movementSpeedMs:this.projectileDetails.projectileSpeed,currentCenterCanvas:a,isAnimating:!0,currentTarget:e,remainingTargets:n}},t.prototype.getCurrentTarget=function(){return this.animationState.currentTarget},t.prototype.getNumRicochetsLeft=function(){return this.projectileDetails.type===yt.BULLET?this.projectileDetails.numRicochets-this.timesRicocheted:0},t.prototype.setIsDead=function(){this.isDead=!0},t.prototype.isTrailGone=function(){return this.trails.every((function(t){return t.distance>t.maxDistance+Rt}))},t.prototype.render=function(){var t,e,n,a=this.context,r=this.projectileDetails.shape;n=r.type===ht.CIRCLE?r.radius:r.size.x;try{for(var o=i(this.trails),s=o.next();!s.done;s=o.next()){var l=s.value;if(!(l.distance<n||l.distance>l.maxDistance+Rt)){var c=l.ray.direction.multiplyScaler(-1),y=0,h=l.ray.pointAtDistance(l.distance),u=h;l.distance>l.maxDistance&&(y=Rt-(l.distance-l.maxDistance),u=l.ray.pointAtDistance(l.maxDistance));var x=Math.min(Rt,l.distance,l.distance+y),d=h.add(c.multiplyScaler(x)),f=a.createLinearGradient(h.x,h.y,d.x,d.y),g=q,m=q+"00";f.addColorStop(0,g),f.addColorStop(1,m),a.strokeStyle=f,a.beginPath(),a.moveTo(u.x,u.y),a.lineTo(d.x,d.y),a.closePath(),a.stroke()}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}if(!this.isDead){var p=this.animationState.currentCenterCanvas;switch(a.fillStyle=this.projectileDetails.color,r.type){case ht.CIRCLE:var T=r.radius;a.beginPath(),a.arc(p.x,p.y,T,0,_t),a.closePath(),a.fill();break;case ht.RECTANGLE:var v=r.size,S=this.getCurrentTarget().ray.direction,C=S.getNormalVectorClockwise(),E=S.multiplyScaler(-v.x/2),A=S.multiplyScaler(v.x/2),I=C.multiplyScaler(-v.y/2),w=C.multiplyScaler(v.y/2),L=p.add(E).add(I),M=p.add(A).add(I),b=p.add(A).add(w),R=p.add(E).add(w);a.beginPath(),a.moveTo(L.x,L.y),a.lineTo(M.x,M.y),a.lineTo(b.x,b.y),a.lineTo(R.x,R.y),a.closePath(),a.fill();break;default:throw new Error("Unknown projectile shape")}}},t}();function Dt(t,e,n){return(e-t)*n+t}function Ft(t){var e=t.length>7?parseInt(t.substring(7,9),16)/255:1;return{r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16),a:e}}function kt(t){return"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")"}!function(t){t.CIRCLE="Circle",t.ELLIPSE="Ellipse",t.LINE="Line",t.PLUS="Plus"}(gt||(gt={}));var Ot,Ht,Nt=2*Math.PI,Gt=function(){function t(t){this.params=t,this.particles=[],this.isAlive=!0,this.tileCoords=E.getTileFromCanvasCoords(t.startPositionCanvas);for(var e,n,a,r=Nt/t.particleCount,i=0;i<t.particleCount;i++){var o=i*r,s=new y(Math.cos(o),Math.sin(o)).normalize(),l=Dt(t.minParticleSpeed,t.maxParticleSpeed,Math.random()),c=Dt(t.minLifetimeMs,t.maxLifetimeMs,Math.random()),h=(e=Ft(t.colorA),n=Ft(t.colorB),a=Math.random(),{r:Dt(e.r,n.r,a),g:Dt(e.g,n.g,a),b:Dt(e.b,n.b,a),a:Dt(e.a,n.a,a)}),u=Dt(t.minRadius,t.maxRadius,Math.random()),x=this.params.shape===gt.ELLIPSE?s.getPointRotationRadians():0;this.particles.push({canvasPosition:t.startPositionCanvas,direction:s,lifetimeMs:c,deltaPositionPerMs:l,color:kt(h),shape:this.params.shape,radius:u,rotationRadians:x})}}return t.prototype.update=function(t){var e=!1;this.particles.forEach((function(n){n.lifetimeMs-=t,n.lifetimeMs>0&&(e=!0,n.canvasPosition=n.canvasPosition.add(n.direction.multiplyScaler(n.deltaPositionPerMs*t)))})),this.isAlive=e},t.prototype.render=function(t){this.particles.forEach((function(e){if(!(e.lifetimeMs<=0)){var n=e.canvasPosition;switch(e.shape){case gt.CIRCLE:t.fillStyle=e.color,t.beginPath(),t.arc(n.x,n.y,e.radius,0,Nt),t.fill();break;case gt.LINE:t.strokeStyle=e.color,t.lineWidth=1,t.beginPath();var a=e.direction.multiplyScaler(e.radius),r=n.add(a),i=n.subtract(a);t.moveTo(r.x,r.y),t.lineTo(i.x,i.y),t.stroke();break;case gt.ELLIPSE:t.fillStyle=e.color,t.beginPath();var o=e.radius,s=e.radius/2;t.ellipse(n.x,n.y,o,s,e.rotationRadians,0,Nt),t.fill();break;case gt.PLUS:t.fillStyle=e.color;var l=e.radius,c=l/4,h=e.canvasPosition.subtract(new y(l,c));t.fillRect(h.x,h.y,2*l,2*c);var u=e.canvasPosition.subtract(new y(c,l));t.fillRect(u.x,u.y,2*c,2*l)}}}))},t}();!function(t){t[t.SHORT=0]="SHORT",t[t.LONG=1]="LONG"}(Ot||(Ot={})),function(t){t[t.TITLE=0]="TITLE",t[t.SUBTITLE=1]="SUBTITLE",t[t.TOAST=2]="TOAST"}(Ht||(Ht={}));var Bt=new Map([[Ot.SHORT,2e3],[Ot.LONG,4e3]]),Wt=new Map([[Ht.TITLE,{fontSize:72,topMargin:E.GAME_HEIGHT/4}],[Ht.SUBTITLE,{fontSize:48,topMargin:E.GAME_HEIGHT/2}],[Ht.TOAST,{fontSize:24,topMargin:7*E.GAME_HEIGHT/8}]]),Ut=function(){function t(t){this.context=t,this.isShowingControlMap=!1,this.titleMsLeft=-1,this.subtitleMsLeft=-1,this.toastMsLeft=-1}return t.prototype.update=function(t){this.titleMsLeft>0&&(this.titleMsLeft-=t),this.subtitleMsLeft>0&&(this.subtitleMsLeft-=t),this.toastMsLeft>0&&(this.toastMsLeft-=t)},t.prototype.render=function(){if(this.titleMsLeft>0){if(!this.titleText)throw new Error("Expected title text to set when titleMsLeft > 0");this.renderText(this.titleText,Wt.get(Ht.TITLE),this.titleMsLeft/Bt.get(this.titleDuration))}if(this.subtitleMsLeft>0){if(!this.subtitleText)throw new Error("Expected subtitle text to set when subtitleMsLeft > 0");this.renderText(this.subtitleText,Wt.get(Ht.SUBTITLE),this.subtitleMsLeft/Bt.get(this.subtitleDuration))}if(this.toastMsLeft>0){if(!this.toastText)throw new Error("Expected toastText text to set when toastMsLeft > 0");this.renderText(this.toastText,Wt.get(Ht.TOAST),this.toastMsLeft/Bt.get(this.toastDuration))}},t.prototype.setText=function(t,e,n){var a=Bt.get(n);switch(e){case Ht.TITLE:this.titleText=t,this.titleMsLeft=a,this.titleDuration=n;break;case Ht.SUBTITLE:this.subtitleText=t,this.subtitleMsLeft=a,this.subtitleDuration=n;break;case Ht.TOAST:this.toastText=t,this.toastMsLeft=a,this.toastDuration=n}},t.prototype.clearText=function(t){switch(t){case Ht.TITLE:this.titleText="",this.titleMsLeft=0;break;case Ht.SUBTITLE:this.subtitleText="",this.subtitleMsLeft=0;break;case Ht.TOAST:this.toastText="",this.toastMsLeft=0}},t.prototype.renderText=function(t,e,n){var a=Ft(R);a.a=n,this.context.fillStyle=kt(a),this.context.font=e.fontSize+"px fantasy";var r=this.context.measureText(t).width,i=new y(E.GAME_WIDTH/2,e.topMargin);this.context.fillText(t,i.x-r/2,i.y-e.fontSize/2)},t}(),zt=n.p+"7b84303c217de9c4be4e53d998b5d30a.jpg",Zt=function(){function t(t){var e=this;this.image=new Image,this.image.onload=function(){e.isLoaded=!0},this.image.src=t}return t.prototype.tryDrawing=function(t){this.isLoaded&&t.context.drawImage(this.image,t.sourceX,t.sourceY,t.sourceWidth,t.sourceHeight,t.canvasX,t.canvasY,t.canvasWidth,t.canvasHeight)},t}(),qt=function(){function t(t){this.texture=new Zt(zt),this.tileCoords=t}return t.prototype.update=function(t){},t.prototype.render=function(t){var e=E.getCanvasFromTileCoords(this.tileCoords);t.fillStyle=D,t.fillRect(e.x,e.y,E.TILE_SIZE,E.TILE_SIZE),P&&this.texture.tryDrawing({context:t,sourceX:e.x,sourceY:e.y,sourceWidth:E.TILE_SIZE,sourceHeight:E.TILE_SIZE,canvasX:e.x,canvasY:e.y,canvasWidth:E.TILE_SIZE,canvasHeight:E.TILE_SIZE})},t.prototype.getEdges=function(){var t=E.getCanvasFromTileCoords(this.tileCoords),e=t.add(new y(E.TILE_SIZE,0)),n=t.add(new y(0,E.TILE_SIZE)),a=t.add(new y(E.TILE_SIZE,E.TILE_SIZE));return[new st(t,e,new y(0,-1)),new st(e,a,new y(1,0)),new st(n,a,new y(0,1)),new st(t,n,new y(-1,0))]},t}();function jt(t){return new ot(t.fromCanvasCoords,new y(Math.cos(t.aimAngleRadiansClockwise),Math.sin(t.aimAngleRadiansClockwise)))}function Kt(t){for(var e=t.ray,n=t.fromTeamIndex,a=t.startingTileCoords,r=t.numRicochets,i=t.characters,o=t.obstacles,s=[],l=r+1,c=a,y=e,h=!1,u=function(e){return null!=i.filter((function(e){return e.teamIndex!==t.fromTeamIndex})).find((function(t){return t.tileCoords.equals(e.tile)}))};l>0&&!h;){var x=Vt({ray:y,startTile:c,fromTeamIndex:n,obstacles:o,characters:i});s.push(x),h=u(x),l-=1;var d=y.direction.reflect(x.normal);y=new ot(x.canvasCoords,d),c=x.tile,x.isTargetGridBorder&&(h=!1,c=E.getTileFromCanvasCoords(x.canvasCoords.add(x.normal.multiplyScaler(-E.TILE_SIZE/2))))}return s}function Vt(t){var e=t.ray,n=t.fromTeamIndex,a=t.startTile,r=function(t){var e,n,a=new y(0,0),r=a.add(new y(E.GAME_WIDTH,0)),o=a.add(new y(0,E.GAME_HEIGHT)),s=r.add(o),l=new st(a,o,new y(1,0)),c=new st(a,r,new y(0,1)),h=new st(r,s,new y(-1,0)),u=new st(o,s,new y(0,-1)),x=[l,c,h,u],d=null,f=null,g=null;try{for(var m=i(x),p=m.next();!p.done;p=m.next()){var T=p.value,v=ct(t,T);if(v.isCollision){var S=(g=T.normal).multiplyScaler(.05*E.TILE_SIZE);d=v.collisionPt.add(S),f=E.getTileFromCanvasCoords(d);break}}}catch(t){e={error:t}}finally{try{p&&!p.done&&(n=m.return)&&n.call(m)}finally{if(e)throw e.error}}if(null==d){ct(t,u),ct(t,h);throw new Error("Shot ray does not intersect with any Grid")}var C=function(t){return Math.abs(t.x-d.x)<.1*E.TILE_SIZE&&Math.abs(t.y-d.y)<.1*E.TILE_SIZE},A=.05*E.TILE_SIZE;C(a)?d=d.add(new y(A,A)):C(r)?d=d.add(new y(-A,A)):C(o)?d=d.add(new y(A,-A)):C(s)&&(d=d.add(new y(-A,-A)));return{normal:g,ray:t,isTargetGridBorder:!0,canvasCoords:d,tile:f,maxDistance:t.startPt.distanceTo(d)}}(e),o=function(t){var e,n,a=3*E.TILE_SIZE/4,r=a,o=t.startTile.toString(),s=new Set([o]),l=null,c=null,y=t.maxDistance,u=null,x=t.ray,d=t.obstacles.map((function(t){return t.tileCoords})).concat(t.characters.map((function(t){return t.tileCoords})));for(;r<t.maxDistance;){var f=E.getTileFromCanvasCoords(t.ray.pointAtDistance(r)),g=[f].concat(E.getAdjacentTiles(f)).filter((function(t){return!s.has(t.toString())})),m=function(e){var n,a,r,o;if(s.add(e.toString()),!h(e,d))return"continue";var f=t.obstacles.find((function(t){return t.tileCoords.equals(e)}));if(f){var g=f.getEdges().filter((function(t){return t.normal.dot(x.direction)<=0}));try{for(var m=(n=void 0,i(g)),p=m.next();!p.done;p=m.next()){var T=p.value;if((E=ct(x,T)).isCollision)(A=x.startPt.distanceTo(E.collisionPt))<y&&(y=A,c=e,l=E.collisionPt,u=T.normal)}}catch(t){n={error:t}}finally{try{p&&!p.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}}else{var v=t.characters.find((function(t){return t.tileCoords.equals(e)}));if(!v)throw new Error("Tile is occupied but no obstacle or character...");if(v.teamIndex===t.fromTeamIndex)return"continue";try{for(var S=(r=void 0,i(v.getEdges())),C=S.next();!C.done;C=S.next()){var E,A;T=C.value;if((E=ct(x,T)).isCollision)(A=x.startPt.distanceTo(E.collisionPt))<y&&(y=A,c=e,l=E.collisionPt,u=T.normal)}}catch(t){r={error:t}}finally{try{C&&!C.done&&(o=S.return)&&o.call(S)}finally{if(r)throw r.error}}}};try{for(var p=(e=void 0,i(g)),T=p.next();!T.done;T=p.next()){var v=T.value;m(v)}}catch(t){e={error:t}}finally{try{T&&!T.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}if(null!=l)break;r+=a}if(null!=c){return{normal:u,isTargetGridBorder:!1,ray:x,tile:c,canvasCoords:l,maxDistance:y}}return null}({startTile:a,ray:e,obstacles:t.obstacles,characters:t.characters,maxDistance:e.startPt.distanceTo(r.canvasCoords),fromTeamIndex:n});return null!=o?o:r}var Yt,Qt,Xt=2*Math.PI,Jt=E.TILE_SIZE/4,$t=function(){function t(t){var e,n;this.gameDelegate=t.gameDelegate,this.tileCoords=t.startCoords,this.animationState={movementSpeedMs:.005*E.TILE_SIZE,isAnimating:!1,remainingTargets:[],currentCenterCanvas:E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE)},this.teamIndex=t.teamIndex,this.index=t.index,this.settings=t.settings,this.health=this.settings.maxHealth,this.hasMoved=!1,this.characterAbilityTypeToAbilityState=new Map;try{for(var a=i(this.settings.extraActions),r=a.next();!r.done;r=a.next()){var o=r.value,s={cooldownTurnsLeft:0};0!==o.maxUses&&(s.usesLeft=o.maxUses),this.characterAbilityTypeToAbilityState.set(o.abilityType,s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}this.isAiming=!1,this.aimAngleRadiansClockwise=0,this.calculateTargetPath(),this.resetTurnState()}return t.prototype.render=function(t){var e,n,a=this.animationState.currentCenterCanvas.subtract(E.HALF_TILE),r=this.animationState.currentCenterCanvas;t.fillStyle=this.getCharacterColor(),t.beginPath(),t.arc(r.x,r.y,Jt,0,Xt),t.closePath(),t.fill();var o=a.add(new y(0,E.TILE_SIZE)),s=""+(this.index+1);t.fillStyle=b;var l=new y(E.TILE_SIZE/12,E.TILE_SIZE/12);t.font="12px fantasy",t.fillText(s,o.x+l.x,o.y-l.y);var c=E.TILE_SIZE/10,h=2*Jt+c,u=this.health/this.settings.maxHealth,x=r.add(new y(-h/2,-Jt-2*c)),d=h*u;switch(t.fillStyle=j,t.fillRect(x.x,x.y,d,c),this.health!==this.settings.maxHealth&&(t.fillStyle=K,t.fillRect(x.x+d,x.y,h-d,c)),this.settings.type){case ft.SCOUT:var f=.75*Jt,g=.75*Jt,m=.75*Jt,p=g/2,T=r.add(new y(-f,-g/2));t.fillStyle="#804526",t.fillRect(T.x,T.y,f,g),t.fillRect(r.x,r.y,m,p);break;case ft.ASSAULT:t.fillStyle="#e8d100";var v=.6*Jt,S=.4*Jt,C=function(e){var n,a;t.beginPath(),t.moveTo(e.x,e.y);var r=[new y(0,-S/2),new y(v/2,-S),new y(v,-S/2),new y(v,0),new y(v/2,-S/2)];try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value,c=e.add(l);t.lineTo(c.x,c.y)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}t.closePath(),t.fill()},A=r.add(new y(-v/2,0)),I=A.add(new y(0,1.5*S));C(A),C(I);break;case ft.SNIPER:t.strokeStyle="#1d1570",t.fillStyle="#1d1570";var w=.7*Jt,L=2*w,M=.2*Jt,R=r.add(new y(-L/2,-M/2));t.fillRect(R.x,R.y,L,M);var _=r.add(new y(-M/2,-L/2));t.fillRect(_.x,_.y,M,L),t.beginPath(),t.arc(r.x,r.y,w,0,Xt),t.closePath(),t.stroke();break;case ft.DEMOLITION:var P=.75*Jt,D=.85*Jt,F=r.add(new y(-P/2,0)),k=t.createLinearGradient(F.x,F.y-D,F.x+P,F.y);k.addColorStop(0,"#f74d40"),k.addColorStop(1,"#e8ba3c"),t.fillStyle=k,function(e){var n,a;t.beginPath(),t.moveTo(e.x,e.y);var r=[new y(P/4,-D/4),new y(P/2,-D/2),new y(P,-D/4),new y(P,0),new y(3*P/4,D/2),new y(P/4,D/2)];try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value,c=e.add(l);t.lineTo(c.x,c.y)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}t.closePath(),t.fill()}(F)}if(this.isAiming){t.strokeStyle=Z;var O=this.settings.gun.aimIndicatorLength,H=r,N=0;t.beginPath(),t.moveTo(H.x,H.y);try{for(var G=i(this.aimPath),B=G.next();!B.done;B=G.next()){var W=B.value.canvasCoords,U=H.distanceTo(W),z=U+N>O;if(z){var q=W.subtract(H).normalize().multiplyScaler(O-N);W=H.add(q)}if(t.lineTo(W.x,W.y),H=W,N+=U,z)break}}catch(t){e={error:t}}finally{try{B&&!B.done&&(n=G.return)&&n.call(G)}finally{if(e)throw e.error}}t.stroke()}},t.prototype.getCurrentTile=function(){return this.animationState.isAnimating?E.getTileFromCanvasCoords(this.animationState.currentCenterCanvas):this.tileCoords},t.prototype.moveTo=function(t,e){if(this.isFinishedWithTurn||this.hasMoved)throw new Error("Already moved.");this.animationState.currentCenterCanvas=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE),this.animationState.currentTarget=e.shift(),this.tileCoords=t,this.animationState.remainingTargets=e,this.animationState.isAnimating=!0,this.hasMoved=!0,this.checkAndSetTurnOver()},t.prototype.update=function(t){if(this.isAiming&&this.calculateTargetPath(),this.animationState.isAnimating){var e=this.animationState.currentTarget,n=e.ray.direction.multiplyScaler(this.animationState.movementSpeedMs*t);n.getMagnitude();this.animationState.currentCenterCanvas=this.animationState.currentCenterCanvas.add(n),e.ray.startPt.distanceTo(this.animationState.currentCenterCanvas)<e.maxDistance||(this.animationState.currentCenterCanvas=e.canvasCoords,0!==this.animationState.remainingTargets.length?this.animationState.currentTarget=this.animationState.remainingTargets.shift():this.animationState.isAnimating=!1)}},t.prototype.skipAnimation=function(){var t=this.animationState.remainingTargets,e=t.length-1,n=t.length>0?this.animationState.remainingTargets[e]:this.animationState.currentTarget;this.animationState.currentCenterCanvas=n.canvasCoords,this.animationState.remainingTargets=[],this.animationState.isAnimating=!1},t.prototype.isAlive=function(){return this.health>0},t.prototype.startAiming=function(){if(!this.canShoot())throw new Error("Already shot or used non-free action.");this.isAiming=!0},t.prototype.cancelAiming=function(){this.isAiming=!1},t.prototype.setAim=function(t){this.aimAngleRadiansClockwise=t},t.prototype.getAim=function(){return this.aimAngleRadiansClockwise},t.prototype.calculateTargetPath=function(){this.aimPath=this.gameDelegate.getCurrentAimPath({ray:jt(this.getCurrentShotInfo()[0]),startingTileCoords:this.tileCoords,fromTeamIndex:this.teamIndex,numRicochets:this.settings.gun.projectileDetails.numRicochets})},t.prototype.shoot=function(){if(!this.canShoot())throw new Error("Already shot or used non - free action.");return this.isAiming=!1,this.hasShot=!0,this.extraAbilities=this.extraAbilities.filter((function(t){return t.isFree})),this.checkAndSetTurnOver(),this.getCurrentShotInfo()},t.prototype.getCurrentShotInfo=function(){var t=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE),e=[{fromTeamIndex:this.teamIndex,fromTileCoords:this.tileCoords,fromCanvasCoords:t,aimAngleRadiansClockwise:this.aimAngleRadiansClockwise,projectileDetails:this.settings.gun.projectileDetails}];if(this.settings.gun.spray)for(var n=this.settings.gun.spray;e.length<n.projectiles;){var a=e.length%2==0?1:-1,r=this.aimAngleRadiansClockwise+n.offsetAngleRadians*a;e.push({fromTeamIndex:this.teamIndex,fromTileCoords:this.tileCoords,fromCanvasCoords:t,aimAngleRadiansClockwise:r,projectileDetails:this.settings.gun.projectileDetails})}return e},t.prototype.getGrenadeAbility=function(){var t=this.extraAbilities.find((function(t){return t.abilityType===dt.THROW_GRENADE}));if(null==t)throw new Error("Trying to getGrenadeAction but character does not have that action");return t},t.prototype.useAbility=function(t){var e=this.extraAbilities.find((function(e){return e.abilityType===t}));if(null==e)throw new Error("Character doesn't have ability for ActionType: "+t);this.extraAbilities=this.extraAbilities.filter((function(e){return e.abilityType!==t}));var n=this.characterAbilityTypeToAbilityState.get(t);n.usesLeft&&(n.usesLeft-=1),n.cooldownTurnsLeft=s(this.settings.extraActions).find((function(t){return t.abilityType===e.abilityType})).cooldownTurns,e.isFree||(this.hasShot=!0,this.extraAbilities=this.extraAbilities.filter((function(t){return t.isFree}))),this.checkAndSetTurnOver()},t.prototype.regenHealth=function(t){this.health=Math.min(this.health+t,this.settings.maxHealth)},t.prototype.getEdges=function(){var t=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE).subtract(new y(Jt,Jt)),e=t.add(new y(2*Jt,0)),n=t.add(new y(0,2*Jt)),a=t.add(new y(2*Jt,2*Jt));return[new st(t,e,new y(0,-1)),new st(e,a,new y(1,0)),new st(n,a,new y(0,1)),new st(t,n,new y(-1,0))]},t.prototype.isTurnOver=function(){return this.isFinishedWithTurn},t.prototype.setTurnOver=function(){this.isFinishedWithTurn=!0,this.isAiming=!1},t.prototype.resetTurnState=function(){var t,e;this.hasMoved=!1,this.hasShot=!1,this.extraAbilities=[];try{for(var n=i(this.settings.extraActions),a=n.next();!a.done;a=n.next()){var r=a.value,o=this.characterAbilityTypeToAbilityState.get(r.abilityType);if(!o)throw new Error("Didn't initialize characterActionsToState for "+r.abilityType);0!==o.usesLeft&&o.cooldownTurnsLeft<=0&&this.extraAbilities.push(r),o.cooldownTurnsLeft-=1}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.isFinishedWithTurn=!1},t.prototype.checkAndSetTurnOver=function(){this.isFinishedWithTurn||this.extraAbilities.some((function(t){return t.isFree}))||(!this.hasMoved||!this.hasShot&&this.settings.gun.canFireAfterMoving)&&(!this.hasShot||this.settings.gun.canFireAfterMoving)||this.setTurnOver()},t.prototype.getCharacterColor=function(){return this.isFinishedWithTurn?0===this.teamIndex?B:G:0===this.teamIndex?N:H},t.prototype.canShoot=function(){return!this.isFinishedWithTurn&&(!(!this.settings.gun.canFireAfterMoving&&this.hasMoved)&&!this.hasShot)},t}();!function(t){t[t.CHARACTER_PLACEMENT=0]="CHARACTER_PLACEMENT",t[t.COMBAT=1]="COMBAT"}(Yt||(Yt={})),function(t){t.AWAITING="AWAITING",t.MOVING="MOVING",t.AIMING="AIMING",t.THROWING_GRENADE="THROWING_GRENADE"}(Qt||(Qt={}));var te,ee=function(){function t(t){this.gamePhase=Yt.CHARACTER_PLACEMENT,this.settings=t,this.obstacles=[],this.characters=[],this.flags=[],this.currentTeamIndex=0,this.selectableTiles=[]}return t.prototype.isFogOfWarOn=function(){return null!=this.settings.hasFogOfWar&&!0===this.settings.hasFogOfWar},t.prototype.isTileVisibleByTeamIndex=function(t,e){var n,a;try{for(var r=i(this.getCharactersForTeamIndex(e)),o=r.next();!o.done;o=r.next()){var s=o.value;if(s.getCurrentTile().manhattanDistanceTo(t)<=s.settings.maxSight)return!0}}catch(t){n={error:t}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return this.getFlagForTeamIndex(e).getCurrentTile().manhattanDistanceTo(t)<=2},t.prototype.getTilesVisibleByTeamIndex=function(t){for(var e=[],n=0;n<E.TILES_WIDE;n++)for(var a=0;a<E.TILES_TALL;a++){var r=new y(n,a);this.isTileVisibleByTeamIndex(r,t)&&e.push(r)}return e},t.prototype.getFirstCharacterIndex=function(){var t=this.getActiveSquad().filter((function(t){return!t.isTurnOver()}));if(0===t.length)throw new Error("No more characters alive - should be game over?");return t[0].index},t.prototype.getGameInfo=function(){return{characters:this.getAliveCharacters(),obstacles:this.obstacles}},t.prototype.getAliveCharacters=function(){return this.characters.filter((function(t){return t.isAlive()}))},t.prototype.getActiveTeamName=function(){switch(this.currentTeamIndex){case 0:return"Blue";case 1:return"Red";default:throw new Error("Unsupported number of teams: "+this.currentTeamIndex)}},t.prototype.getEnemyTeamName=function(){switch(this.currentTeamIndex){case 1:return"Blue";case 0:return"Red";default:throw new Error("Unsupported number of teams: "+this.currentTeamIndex)}},t.prototype.getActiveSquad=function(){var t=this;return this.getAliveCharacters().filter((function(e){return e.teamIndex===t.currentTeamIndex}))},t.prototype.getEnemyCharacters=function(){var t=this;return this.getAliveCharacters().filter((function(e){return e.teamIndex!==t.currentTeamIndex}))},t.prototype.getActiveTeamFlag=function(){var t=this;return this.flags.find((function(e){return e.teamIndex===t.currentTeamIndex}))},t.prototype.getEnemyFlag=function(){var t=this;return this.flags.find((function(e){return e.teamIndex!==t.currentTeamIndex}))},t.prototype.tileHasObstacle=function(t){return null!=this.obstacles.find((function(e){return e.tileCoords.equals(t)}))},t.prototype.enemyHasFlag=function(){var t=this.getActiveTeamFlag().tileCoords;return null!=this.getEnemyCharacters().find((function(e){return e.tileCoords.equals(t)}))},t.prototype.teamHasFlag=function(){var t=this.getEnemyFlag().tileCoords;return null!=this.getActiveSquad().find((function(e){return e.tileCoords.equals(t)}))},t.prototype.getPath=function(t){var e=this,n=function(t){return!e.tileHasObstacle(t)};return function(t){for(var e,n,a=t.startTile,r=t.endTile,o=t.isAvailable,l=t.canGoThrough,c=new Map,y=[a].map((function(t){return{parent:a,coords:t}})),h=!1;!h;){var u=y.shift();if(l(u.coords)){if(o(u.coords)&&!c.has(u.coords.toString())&&c.set(u.coords.toString(),u),u.coords.equals(r)){h=!0;break}var x=function(t){var e=c.has(t.toString()),n=null!=y.find((function(e){return e.coords.equals(t)}));e||n||!o(t)||y.push({parent:u.coords,coords:t})};try{for(var d=(e=void 0,i(E.getAdjacentTiles(u.coords))),f=d.next();!f.done;f=d.next()){x(f.value)}}catch(t){e={error:t}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}}}for(var g=function(t){return s(c.values()).find((function(e){return e.coords.equals(t)}))},m=g(r),p=[];!m.coords.equals(a);)p.push(m.coords),m=g(m.parent);return p.reverse()}({startTile:t.from,endTile:t.to,isAvailable:n,canGoThrough:n})},t.prototype.isSquadMemberAtTile=function(t){var e=this;return null!=this.getActiveSquad().find((function(n){return n.isAlive()&&n.tileCoords.equals(t)&&n!==e.selectedCharacter}))},t.prototype.getCharactersForTeamIndex=function(t){return this.getAliveCharacters().filter((function(e){return e.teamIndex===t}))},t.prototype.getFlagForTeamIndex=function(t){return this.flags[t]},t}();function ne(t){return t[Math.floor(Math.random()*t.length)]}!function(t){t.TARGET_FINDING="Targets",t.AI="AI",t.ACTIONS="Actions"}(te||(te={}));var ae,re=new(function(){function t(){this.logTypeToIsLogging=new Map([[te.TARGET_FINDING,!1],[te.AI,!0],[te.ACTIONS,!1]]),this.logTypeToLogs=new Map([[te.ACTIONS,[]],[te.AI,[]],[te.TARGET_FINDING,[]]])}return t.prototype.log=function(t,e){this.logTypeToLogs.get(t).push(e),this.logTypeToIsLogging.get(t)&&console.log(e)},t}()),ie={randomizeMovement:!1,maxAngleRandomization:Math.PI/18,ignoresFogOfWar:!1,characterClass:wt,heals:!1},oe={randomizeMovement:!0,maxAngleRandomization:Math.PI/24,ignoresFogOfWar:!1,characterClass:Lt,heals:!1},se={randomizeMovement:!0,maxAngleRandomization:0,ignoresFogOfWar:!1,characterClass:Lt,heals:!1},le=new Map([[w.WEAK,ie],[w.MEDIUM,oe],[w.STRONG,se]]);!function(t){t.DEFEND="DEFEND",t.ELIMINATE="ELIMINATE",t.SNAG="SNAG"}(ae||(ae={}));var ce=function(){function t(t){var e=t.teamIndex,n=t.difficulty;this.teamIndex=e,this.difficulty=n,this.log("AI created on "+n+" difficulty"),this.settings=le.get(n),this.actionQueue=[],this.characterIndexToPriority=new Map}return t.prototype.getNextAction=function(t){0===this.actionQueue.length&&(this.actionQueue=this.getActionsForGameState(t));var e=this.actionQueue.shift();if(null==e)throw new Error("AI couldn't get action to perform");var n=e(t);return null!=t.selectedCharacter&&this.log("selected character index - "+t.selectedCharacter.index),this.log("AI: Taking action: "+JSON.stringify(n)),n},t.prototype.getActionsForGameState=function(t){if(t.gamePhase===Yt.CHARACTER_PLACEMENT)return this.placeCharacter(t);if(null==t.selectedCharacter||null==t.selectedCharacterState)throw new Error("Expected a selected character and state");var e=t.selectedCharacter;this.characterIndexToPriority.has(e.index)||this.assignPriority(e.index,t);t.selectedCharacterState;if(e.tileCoords.equals(t.getEnemyFlag().tileCoords)&&!e.hasMoved)return this.getActionsForFlagCarrrier(e,t);if(!e.hasMoved&&!e.hasShot)return this.getHasntMovedNorShot(e,t);if(!e.hasShot){var n=ye(e.tileCoords),a=this.getEnemyTargetsInDirectSight(n,t);if(a.length>0)return this.getShootSequence(this.getBestShot(e.tileCoords,t,a))}if(this.settings.heals&&e.health<e.settings.maxHealth&&null!=e.extraAbilities.find((function(t){return t.abilityType===dt.HEAL}))){return[function(t){return{type:ut.HEAL,healAmount:e.extraAbilities.find((function(t){return t.abilityType===dt.HEAL})).healAmount}}]}return[function(t){return{type:ut.END_CHARACTER_TURN}}]},t.prototype.placeCharacter=function(t){var e=this,n=t.getActiveSquad().length;this.assignPriority(n,t);var a=this.characterIndexToPriority.get(n);return[function(t){return{type:ut.SELECT_CHARACTER_CLASS,class:e.settings.characterClass}},function(t){t.selectableTiles[0];var n=[];if((n=a===ae.DEFEND?e.getClosestSelectableTileToLocationWithFewestDirectHits(t.getActiveTeamFlag().tileCoords,t):e.getClosestSelectableTileToLocationWithFewestDirectHits(t.getEnemyFlag().tileCoords,t)).length>0){var r=n[0];return e.settings.randomizeMovement&&(r=ne(n)),{type:ut.SELECT_TILE,tile:r}}return e.log("AI: No optimal tiles in placement"),{type:ut.SELECT_TILE,tile:t.selectableTiles[0]}}]},t.prototype.getHasntMovedNorShot=function(t,e){var n,a,r=this,o=ye(t.tileCoords),s=this.characterIndexToPriority.get(t.index),l=this.getEnemyTargetsInDirectSight(o,e);if(l.length>0){var c=this.getShootSequence(this.getBestShot(t.tileCoords,e,l)),y=null;if(s===ae.DEFEND)y=e.getActiveTeamFlag().tileCoords;else if(s===ae.ELIMINATE){var h=this.getVisibleEnemies(e);if(h.length>0){var u=[];try{for(var x=i(h),d=x.next();!d.done;d=x.next()){var f=d.value,g={dist:f.tileCoords.manhattanDistanceTo(t.tileCoords),tile:f.tileCoords,hp:f.health};0===u.length?u.push(g):g.hp<u[0].hp||g.hp===u[0].hp&&g.dist<u[0].dist?u=[g]:g.hp===u[0].hp&&g.dist===u[0].dist&&u.push(g)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}y=u[0].tile,this.settings.randomizeMovement&&(y=ne(u).tile)}else y=e.enemyHasFlag()?e.getActiveTeamFlag().tileCoords:e.getEnemyFlag().tileCoords}else y=e.enemyHasFlag()?e.getActiveTeamFlag().tileCoords:e.getEnemyFlag().tileCoords;var m=this.getSafeMoveTowardsLocation(t,y);return c.concat(m)}return[function(t){return{type:ut.SELECT_CHARACTER_STATE,state:Qt.MOVING}},function(e){var n,a,o,l,c,y,h=e.selectedCharacter,u=h.health===h.settings.maxHealth;if(0===e.selectableTiles.length)return r.log("AI: No selectable tiles when able to move"),{type:ut.END_CHARACTER_TURN};var x=[];try{for(var d=i(e.selectableTiles),f=d.next();!f.done;f=d.next()){var g=f.value,m=ye(g),p=r.getEnemyTargetsInDirectSight(m,e);x.push({tile:g,directHits:p.length})}}catch(t){n={error:t}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}var T=[],v=r.getVisibleEnemies(e),S=x.filter((function(t){return 1===t.directHits||2===t.directHits&&u}));if(S.length>0)T=S.map((function(t){return t.tile}));else{var C=null;if(s===ae.DEFEND)if(e.getActiveTeamFlag().isAtStart()){var E=v.filter((function(t){return t.tileCoords.manhattanDistanceTo(h.tileCoords)<=h.settings.maxSight}));if(0===v.length||0===E.length){T=e.selectableTiles.filter((function(t){return t.manhattanDistanceTo(e.getActiveTeamFlag().tileCoords)<5}))}else{var A=[];try{for(var I=i(E),w=I.next();!w.done;w=I.next()){var L={hp:(R=w.value).health,tile:R.tileCoords};0===A.length?A.push(L):R.health<A[0].hp?A=[L]:R.health===A[0].hp&&A.push(L)}}catch(t){o={error:t}}finally{try{w&&!w.done&&(l=I.return)&&l.call(I)}finally{if(o)throw o.error}}C=A[0].tile,r.settings.randomizeMovement&&(C=ne(A).tile)}}else C=e.getActiveTeamFlag().tileCoords;else if(s===ae.ELIMINATE)if(v.length>0){A=[];try{for(var M=i(v),b=M.next();!b.done;b=M.next()){var R;L={dist:(R=b.value).tileCoords.manhattanDistanceTo(t.tileCoords),tile:R.tileCoords,hp:R.health};0===A.length?A.push(L):L.hp<A[0].hp||L.hp===A[0].hp&&L.dist<A[0].dist?A=[L]:L.hp===A[0].hp&&L.dist===A[0].dist&&A.push(L)}}catch(t){c={error:t}}finally{try{b&&!b.done&&(y=M.return)&&y.call(M)}finally{if(c)throw c.error}}var _=A.map((function(t){return t.tile}));C=_[0],r.settings.randomizeMovement&&(C=ne(_))}else C=e.enemyHasFlag()?e.getActiveTeamFlag().tileCoords:e.getEnemyFlag().tileCoords;else C=e.enemyHasFlag()?e.getActiveTeamFlag().tileCoords:e.getEnemyFlag().tileCoords;null!=C&&(T=r.getClosestSelectableTileToLocationWithFewestDirectHits(C,e))}var P=T[0];return r.settings.randomizeMovement&&(P=ne(T)),null==P?{type:ut.END_CHARACTER_TURN}:{type:ut.SELECT_TILE,tile:P}}]},t.prototype.getActionsForFlagCarrrier=function(t,e){var n=e.getActiveTeamFlag().tileCoords;return this.getSafeMoveTowardsLocation(t,n)},t.prototype.getSafeMoveTowardsLocation=function(t,e){var n=this;return[function(t){return{type:ut.SELECT_CHARACTER_STATE,state:Qt.MOVING}},function(t){var a=n.getClosestSelectableTileToLocationWithFewestDirectHits(e,t),r=a[0];return n.settings.randomizeMovement&&(r=ne(a)),null==r?{type:ut.END_CHARACTER_TURN}:{type:ut.SELECT_TILE,tile:r}}]},t.prototype.getClosestSelectableTileToLocationWithFewestDirectHits=function(t,e){var n,a,r={tile:e.selectableTiles[0],distance:1e4,directHits:100},o=[];try{for(var s=i(e.selectableTiles),l=s.next();!l.done;l=s.next()){var c=l.value,y=he(c,t,e),h=ye(c),u=this.getEnemyTargetsInDirectSight(h,e).length;u<r.directHits||u===r.directHits&&y.length<r.distance?(r.tile=c,r.distance=y.length,r.directHits=u,o=[r.tile]):u===r.directHits&&y.length===r.distance&&o.push(c)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return o},t.prototype.getBestShot=function(t,e,n){var a,r,o,s;try{for(var l=i(n),c=l.next();!c.done;c=l.next()){if((f=c.value).target.tile.equals(e.getActiveTeamFlag().tileCoords))return f}}catch(t){a={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(a)throw a.error}}var y=e.getEnemyCharacters(),h=null,u=function(e){var n=y.find((function(t){return t.tileCoords.equals(e.target.tile)}));if(null==n)throw new Error("Expected a character at shot: "+JSON.stringify(e));var a=n.health,r=n.tileCoords.manhattanDistanceTo(t);(null==h||a<h.targetHealth||a===h.targetHealth&&r<h.distance)&&(h={shot:e,distance:r,targetHealth:a})};try{for(var x=i(n),d=x.next();!d.done;d=x.next()){var f;u(f=d.value)}}catch(t){o={error:t}}finally{try{d&&!d.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}if(null==h)throw new Error("Expected to find best shot in getBestShot");return h.shot},t.prototype.getShootSequence=function(t){var e=this;return[function(t){return{type:ut.SELECT_CHARACTER_STATE,state:Qt.AIMING}},function(n){var a=Math.random()*e.settings.maxAngleRandomization*-e.settings.maxAngleRandomization/2,r=t.aimAngleClockwiseRadians+a;return{type:ut.AIM,aimAngleClockwiseRadians:r}},function(t){return{type:ut.SHOOT}}]},t.prototype.getEnemyTargetsInDirectSight=function(t,e){var n,a,r,o,s=E.getTileFromCanvasCoords(t),l=[],c=this.getVisibleEnemies(e);try{for(var h=i(c),u=h.next();!u.done;u=h.next()){var x=u.value,d=ye(x.tileCoords).subtract(t).normalize().getPointRotationRadians(),f=Vt({ray:(r=t,o=d,new ot(r,new y(Math.cos(o),Math.sin(o)))),characters:e.getAliveCharacters(),obstacles:e.obstacles,fromTeamIndex:this.teamIndex,startTile:s});f.tile.equals(x.tileCoords)&&l.push({aimAngleClockwiseRadians:d,target:f})}}catch(t){n={error:t}}finally{try{u&&!u.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}return l},t.prototype.getVisibleEnemies=function(t){var e=this;return t.getEnemyCharacters().filter((function(n){return!!e.settings.ignoresFogOfWar||t.isTileVisibleByTeamIndex(n.tileCoords,e.teamIndex)}))},t.prototype.assignPriority=function(t,e){var n=this.getNextPriority(e);this.log("AI: Assigning priority: "+n),this.characterIndexToPriority.set(t,n)},t.prototype.getNextPriority=function(t){var e=this,n=t.settings.teamIndexToSquadSize.get(this.teamIndex),a=1/4*n,r=.5*n;return t.getActiveSquad().filter((function(t){var n=e.characterIndexToPriority.get(t.index);return null!=n&&n===ae.DEFEND})).length<a?ae.DEFEND:t.getActiveSquad().filter((function(t){var n=e.characterIndexToPriority.get(t.index);return null!=n&&n===ae.SNAG})).length<r?ae.SNAG:ae.ELIMINATE},t.prototype.log=function(t){re.log(te.AI,t)},t}();function ye(t){return E.getCanvasFromTileCoords(t).add(E.HALF_TILE)}function he(t,e,n){return n.getPath({from:t,to:e})}var ue=function(){function t(t){this.tileCoords=t.tileCoords,this.teamIndex=t.teamIndex,this.turnsBetweenSpawns=t.turnsBetweenSpawns,this.turnsSinceLastSpawn=0}return t.prototype.update=function(t){},t.prototype.advanceTurn=function(){this.turnsSinceLastSpawn+=1},t.prototype.checkAndHandleRespawn=function(){return this.turnsSinceLastSpawn===this.turnsBetweenSpawns&&(this.turnsSinceLastSpawn=0,!0)},t.prototype.render=function(t){t.strokeStyle=0===this.teamIndex?N:H;for(var e=E.getCanvasFromTileCoords(this.tileCoords).add(E.HALF_TILE),n=Math.PI/16,a=Math.PI/32,r=0,i=2*Math.PI-n,o=.4*E.TILE_SIZE;r<i;)t.beginPath(),t.arc(e.x,e.y,o,r,r+n),t.stroke(),r+=n+a;var s=""+(this.turnsBetweenSpawns-this.turnsSinceLastSpawn);t.fillStyle=b;new y(E.TILE_SIZE/12,E.TILE_SIZE/12);t.font="12px fantasy",t.fillText(s,e.x-3,e.y+1)},t}(),xe=function(){function t(t){this.context=t,this.elements=[]}return t.prototype.addElement=function(t){this.elements.push(t)},t.prototype.removeAll=function(){this.elements=[]},t.prototype.removeElement=function(t){this.elements.splice(this.elements.indexOf(t),1)},t.prototype.onMouseMove=function(t){var e,n,a=this.getUiCoords(t);try{for(var r=i(this.elements),o=r.next();!o.done;o=r.next()){o.value.onMouseMove(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.onClick=function(t){var e,n,a=this.getUiCoords(t);try{for(var r=i(this.elements),o=r.next();!o.done;o=r.next()){if(o.value.onClick(a))return!0}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!1},t.prototype.render=function(){var t,e;try{for(var n=i(this.elements),a=n.next();!a.done;a=n.next()){a.value.render(this.context)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.getUiCoords=function(t){return new y(t.x/a.canvasWidth,t.y/a.canvasHeight)},t}(),de=function(){function t(t){var e=this,n=t.dimensions,a=t.style;this.render=function(t){var n=e.getCanvasCoords(e.topLeft),a=e.getCanvasCoords(e.size);t.fillStyle=e.color,t.fillRect(n.x,n.y,a.x,a.y),t.fillStyle=e.textColor;var r=e.fontSize;t.font=r+"px fantasy";var i=t.measureText(e.text).width,o=e.getCanvasCoords(e.getBoxCenter());t.fillText(e.text,o.x-i/2,o.y+r/4)},this.onClick=function(t){return!1},this.onMouseMove=function(t){},this.topLeft=n.topLeft,this.size=n.size,this.text=n.text,this.fontSize=a.fontSize,this.color=a.color,this.textColor=a.textColor}return t.prototype.getBoxCenter=function(){return new y(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2)},t.prototype.getCanvasCoords=function(t){return new y(t.x*a.canvasWidth,t.y*a.canvasHeight)},t}(),fe=function(){function t(t){var e=this,n=t.dimensions,a=t.style,r=t.onClick;this.render=function(t){var n=e.getCanvasCoords(e.topLeft),a=e.getCanvasCoords(e.size);t.fillStyle=e.getFillColor(),t.fillRect(n.x,n.y,a.x,a.y),t.fillStyle=e.textColor;var r=e.fontSize;t.font=r+"px fantasy";var i=t.measureText(e.text).width,o=e.getCanvasCoords(e.getButtonCenter());if(t.fillText(e.text,o.x-i/2,o.y+r/4),e.isSelected){if(null==e.selectedBorderColor)throw new Error("Selected border color should be set when button is selected");t.strokeStyle=e.selectedBorderColor,t.strokeRect(n.x,n.y,a.x,a.y)}},this.onClick=function(t){return!!e.isInButton(t)&&(e.onClickCallback(),!0)},this.onMouseMove=function(t){e.isHovered=e.isInButton(t)},this.topLeft=n.topLeft,this.size=n.size,this.text=n.text,this.fontSize=a.fontSize,this.color=a.color,this.textColor=a.textColor,this.hoverColor=a.hoverColor,this.selectedColor=a.selectedColor,this.selectedBorderColor=a.selectedBorderColor,this.onClickCallback=r,this.isHovered=!1,this.isSelected=!1}return t.prototype.getFillColor=function(){return this.isSelected?this.selectedColor:this.isHovered?this.hoverColor:this.color},t.prototype.setIsSelected=function(t){this.isSelected=t},t.prototype.isInButton=function(t){var e=t.x>=this.topLeft.x&&t.x<=this.topLeft.x+this.size.x,n=t.y>=this.topLeft.y&&t.y<=this.topLeft.y+this.size.y;return e&&n},t.prototype.getButtonCenter=function(){return new y(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2)},t.prototype.getCanvasCoords=function(t){return new y(t.x*a.canvasWidth,t.y*a.canvasHeight)},t}(),ge=function(){function t(t){var e=this;this.render=function(t){var n,a;try{for(var r=i(e.buttons),o=r.next();!o.done;o=r.next()){o.value.render(t)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}},this.onClick=function(t){var n,a;try{for(var r=i(e.buttons),o=r.next();!o.done;o=r.next()){if(o.value.onClick(t))return!0}}catch(t){n={error:t}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return!1},this.onMouseMove=function(t){var n,a;try{for(var r=i(e.buttons),o=r.next();!o.done;o=r.next()){o.value.onMouseMove(t)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}},this.onButtonClicked=function(t){t!==e.currentlySelectedIndex&&(e.buttons[e.currentlySelectedIndex].setIsSelected(!1),e.currentlySelectedIndex=t,e.buttons[e.currentlySelectedIndex].setIsSelected(!0),e.onChangeCallback(e.currentlySelectedIndex))},this.buttons=[];for(var n=function(n){var r=t.buttons[n];a.buttons.push(new fe({dimensions:{topLeft:r.topLeft,size:r.size,text:r.text},style:{fontSize:t.buttonStyle.fontSize,color:t.buttonStyle.color,hoverColor:t.buttonStyle.hoverColor,textColor:t.buttonStyle.textColor,selectedColor:t.buttonStyle.selectedColor,selectedBorderColor:t.buttonStyle.selectedBorderColor},onClick:function(){e.onButtonClicked(n)}}))},a=this,r=0;r<t.buttons.length;r++)n(r);this.onChangeCallback=t.onChangeCallback,this.currentlySelectedIndex=t.initialSelectionIndex,this.buttons[this.currentlySelectedIndex].setIsSelected(!0)}return t.prototype.select=function(t){var e,n;try{for(var a=i(this.buttons),r=a.next();!r.done;r=a.next()){r.value.setIsSelected(!1)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}this.buttons[t].setIsSelected(!0)},t}(),me=function(){function t(t){this.context=t,this.borderWidth=8,this.leftEdgeCanvas=E.GAME_WIDTH,this.leftUiCoord=(E.GAME_WIDTH+this.borderWidth)/a.canvasWidth,this.widthUi=1-this.leftUiCoord,this.horizontalMargins=.01,this.maxWidth=this.widthUi-2*this.horizontalMargins,this.leftMargin=this.leftUiCoord+this.horizontalMargins,this.maxWidthUi=1-this.leftMargin-this.horizontalMargins,this.fontSize=18,this.descriptionFontSize=16,this.buttonOffsetY=.01,this.buttonSize=new y(this.maxWidth,.05),this.headerSize=new y(this.maxWidth,.025),this.headerStyle={color:V,fontSize:this.fontSize,textColor:tt},this.buttonStyle={fontSize:this.fontSize,color:Y,hoverColor:Q,selectedColor:X,selectedBorderColor:J,textColor:$},this.uiManager=new xe(t)}return t.prototype.update=function(t){},t.prototype.mouseMove=function(t){this.uiManager.onMouseMove(t)},t.prototype.tryClick=function(t){return this.uiManager.onClick(t)},t.prototype.render=function(t){t.fillStyle=V,t.fillRect(this.leftEdgeCanvas,0,E.BUTTON_PANE_WIDTH,E.BUTTON_PANE_HEIGHT),t.fillStyle="#000000",t.fillRect(this.leftEdgeCanvas,0,this.borderWidth,E.BUTTON_PANE_HEIGHT),this.uiManager.render()},t.prototype.selectIndex=function(t){if(void 0===this.buttonGroup)throw new Error("No buttonGroup in selectIndex'");this.buttonGroup.select(t)},t.prototype.clear=function(){this.buttonGroup=void 0,this.clearBottomButtons(),this.clearDescription(),this.uiManager.removeAll()},t.prototype.configurePanel=function(t){for(var e=t.headerTextLines,n=t.buttonInfos,a=t.isButtonGroup,r=e.length,i=.02,o=0;o<r;o++){var s=new de({dimensions:{size:this.headerSize,text:e[o],topLeft:new y(this.leftMargin,i)},style:this.headerStyle});this.uiManager.addElement(s),i+=this.buttonOffsetY+this.headerSize.y}for(var l=[],c=0;c<n.length;c++){var h=i+(o=c%6)*this.buttonOffsetY+o*this.buttonSize.y,u=n[c];l.push({topLeft:new y(this.leftMargin,h),size:this.buttonSize,text:u.name+" ("+p.getStringForKey(u.key)+")"})}if(a)this.buttonGroup=new ge({buttons:l,buttonStyle:this.buttonStyle,initialSelectionIndex:0,onChangeCallback:function(t){n[t].func()}}),this.uiManager.addElement(this.buttonGroup);else for(var x=0;x<n.length;x++){var d=l[x];this.uiManager.addElement(new fe({dimensions:d,style:this.buttonStyle,onClick:n[x].func}))}var f=l[l.length-1];this.buttonGroupBottomMargin=f.topLeft.y+f.size.y},t.prototype.setDescription=function(t){var e=this.buttonGroupBottomMargin+2*this.buttonOffsetY;this.clearDescription();for(var n={fontSize:this.descriptionFontSize,color:this.headerStyle.color,textColor:this.headerStyle.textColor},r=0;r<t.length;r++){var i=t[r];this.context.font=this.descriptionFontSize+"px fantasy";var o=this.context.measureText(i).width/a.canvasWidth,s=new y(o,this.headerSize.y),l=new de({dimensions:{size:s,text:i,topLeft:new y(this.leftMargin,e)},style:n});this.descriptionTextBoxes.push(l),this.uiManager.addElement(l),e+=this.headerSize.y-.002}},t.prototype.clearDescription=function(){var t,e;if(null!=this.descriptionTextBoxes){try{for(var n=i(this.descriptionTextBoxes),a=n.next();!a.done;a=n.next()){var r=a.value;this.uiManager.removeElement(r)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.descriptionTextBoxes=[]}else this.descriptionTextBoxes=[]},t.prototype.setBottomButtons=function(t){var e,n;this.clearBottomButtons();var a=1+(-this.buttonOffsetY-this.buttonSize.y)*t.length;try{for(var r=i(t),o=r.next();!o.done;o=r.next()){var s=o.value,l={topLeft:new y(this.leftMargin,a),size:this.buttonSize,text:s.name+" ("+p.getStringForKey(s.key)+")"},c=new fe({dimensions:l,style:this.buttonStyle,onClick:s.func});this.uiManager.addElement(c),this.bottomButtons.push(c),a+=this.buttonOffsetY+this.buttonSize.y}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.clearBottomButtons=function(){var t,e;if(null!=this.bottomButtons&&this.bottomButtons.length>0)try{for(var n=i(this.bottomButtons),a=n.next();!a.done;a=n.next()){var r=a.value;this.uiManager.removeElement(r)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.bottomButtons=[]},t}(),pe=x.P,Te=x.Q,ve=x.R,Se=x.M,Ce=x.A,Ee=x.S,Ae=x.D,Ie=x.SHIFT,we=x.F,Le=x.H,Me=x.T,be=x.E,Re=new Map([[x.J,ft.SCOUT],[x.K,ft.ASSAULT],[x.L,ft.SNIPER],[x.I,ft.DEMOLITION]]),_e=function(){function t(t,e){this.context=t,this.delegate=e,this.gameClickHandler=null,this.controlMap=new d,this.buttonPanel=new me(this.context)}return t.prototype.clear=function(){this.controlMap.clear(),this.buttonPanel.clear(),this.gameClickHandler=null},t.prototype.render=function(){this.buttonPanel.render(this.context)},t.prototype.update=function(t){if(this.controlMap.check(),this.buttonPanel.mouseMove(p.getMouseCanvasCoords()),p.hasClick()){var e=p.handleClick();if(!this.buttonPanel.tryClick(e)){var n=E.getTileFromCanvasCoords(e);null!=this.gameClickHandler&&this.gameClickHandler.onClick(n)}}},t.prototype.initDefaultControls=function(){this.clear(),this.addDefaultControls()},t.prototype.initForCharacterPlacement=function(){var t=this;this.clear(),this.gameClickHandler={onClick:function(e){t.tryPlacingCharacter(e)}},this.addDefaultControls(),this.addCharacterClassControls()},t.prototype.initGameOverControls=function(){this.clear(),this.addQuitAndRestartControls(!0);var t=p.getStringForKey(Te),e=p.getStringForKey(ve);this.delegate.setToastText("Press "+t+" to quit, "+e+" to restart")},t.prototype.initForSelectedCharacterState=function(){var t,e,n,a,r=this;this.clear();var o=this.delegate,c=o.getGameState();if(null==c.selectedCharacter||null==c.selectedCharacterState)throw new Error("There needs to be a selected character before calling setSelectedCharacterState");this.buttonPanel.clear(),this.controlMap.clear(),this.gameClickHandler=null,this.addDefaultControls(),this.addSwitchSquadMemberControls();var y,h,u=Math.PI/64,x=[],d=[];switch(c.selectedCharacterState){case Qt.AWAITING:d=["Available actions"],c.selectedCharacter.hasMoved||x.push({key:Se,name:"Move",func:function(){var t={type:ut.SELECT_CHARACTER_STATE,state:Qt.MOVING};o.onAction(t)},eventType:l.KeyPress}),c.selectedCharacter.canShoot()&&x.push({key:Ce,name:"Aim",func:function(){var t={type:ut.SELECT_CHARACTER_STATE,state:Qt.AIMING};o.onAction(t)},eventType:l.KeyPress});var f=function(t){switch(t.abilityType){case dt.HEAL:x.push({key:Le,name:"Heal",func:function(){var e={type:ut.HEAL,healAmount:t.healAmount};o.onAction(e)},eventType:l.KeyPress});break;case dt.THROW_GRENADE:x.push({key:Me,name:"Throw grenade",func:function(){var t={type:ut.SELECT_CHARACTER_STATE,state:Qt.THROWING_GRENADE};o.onAction(t)},eventType:l.KeyPress})}};try{for(var g=i(c.selectedCharacter.extraAbilities),m=g.next();!m.done;m=g.next()){f(m.value)}}catch(e){t={error:e}}finally{try{m&&!m.done&&(e=g.return)&&e.call(g)}finally{if(t)throw t.error}}break;case Qt.MOVING:d=["Select a destination"],this.gameClickHandler={onClick:function(t){r.tryMovingSelectedCharacter(t)}},x.push({key:Se,name:"Cancel Move",func:function(){var t={type:ut.SELECT_CHARACTER_STATE,state:Qt.AWAITING};o.onAction(t)},eventType:l.KeyPress});break;case Qt.AIMING:d=["Adjust aim and fire"],x.push({key:Ce,name:"Stop Aiming",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when canceling shooting.");var t={type:ut.SELECT_CHARACTER_STATE,state:Qt.AWAITING};o.onAction(t)},eventType:l.KeyPress}),x.push({key:Ee,name:"Aim CCW",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when aiming CCW.");var t=-u;p.isKeyDown(Ie)&&(t+=u/2);var e=c.selectedCharacter.getAim()+t,n={type:ut.AIM,aimAngleClockwiseRadians:e};o.onAction(n)},eventType:l.KeyDown}),x.push({key:Ae,name:"Aim CC",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when aiming CC.");var t=u;p.isKeyDown(Ie)&&(t-=u/2);var e=c.selectedCharacter.getAim()+t,n={type:ut.AIM,aimAngleClockwiseRadians:e};o.onAction(n)},eventType:l.KeyDown}),x.push({key:we,name:"Fire",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when canceling shooting.");var t={type:ut.SHOOT};o.onAction(t)},eventType:l.KeyPress});break;case Qt.THROWING_GRENADE:d=["Select grenade target"],this.gameClickHandler={onClick:function(t){r.tryThrowingGrenade(t)}},x.push({key:Me,name:"Cancel",func:function(){var t={type:ut.SELECT_CHARACTER_STATE,state:Qt.AWAITING};o.onAction(t)},eventType:l.KeyPress});break;default:throw new Error("Unknown selected character state")}x.push({key:be,name:"End character turn",func:function(){if(null==c.selectedCharacter)throw new Error("There's no selected character when ending turn.");var t={type:ut.END_CHARACTER_TURN};o.onAction(t)},eventType:l.KeyPress}),this.buttonPanel.configurePanel({headerTextLines:d,buttonInfos:x,isButtonGroup:!1}),this.buttonPanel.setDescription((y=c.selectedCharacter,h=[],Pe(y.settings.type),h.push.apply(h,s(["HP: "+Math.round(y.health)+" / "+y.settings.maxHealth,"Moves: "+y.settings.maxMovesPerTurn,"Sight: "+y.settings.maxSight,"","Gun:"],Fe(y.settings.gun).map((function(t){return"  "+t})),["","Abilities:"],function(t){var e,n,a=[],r=t.characterAbilityTypeToAbilityState,o=function(e){var n=r.get(e);if(null==n.usesLeft||n.usesLeft<=0)return"continue";a.push("");for(var i=ke(s(t.settings.extraActions).find((function(t){return t.abilityType===e}))),o=0;o<i.length;o++){var l=i[o];l.indexOf("Max uses")>0?i[o]="  Uses left: "+n.usesLeft:l.indexOf("Cooldown turns")>0&&(n.cooldownTurnsLeft>0?i[o]="  Cooling down ("+n.cooldownTurnsLeft+" turns til ready)":i[o]="  Ready to use")}a.push.apply(a,s(i))};try{for(var l=i(r.keys()),c=l.next();!c.done;c=l.next()){var y=c.value;o(y)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return a}(y).map((function(t){return"  "+t})))),h));try{for(var T=i(x),v=T.next();!v.done;v=T.next()){var S=v.value;this.controlMap.add(S)}}catch(t){n={error:t}}finally{try{v&&!v.done&&(a=T.return)&&a.call(T)}finally{if(n)throw n.error}}},t.prototype.tryPlacingCharacter=function(t){if(this.delegate.getGameState().selectableTiles.find((function(e){return e.equals(t)}))){var e={type:ut.SELECT_TILE,tile:t};this.delegate.onAction(e)}else this.delegate.setToastText("Can't place character here")},t.prototype.trySelectingCharacter=function(t){var e=this.delegate.getGameState().getActiveSquad().find((function(e){return e.tileCoords.equals(t)}));if(e&&!e.isTurnOver()){var n={type:ut.SELECT_CHARACTER,characterIndex:e.index};this.delegate.onAction(n)}},t.prototype.tryMovingSelectedCharacter=function(t){if(this.delegate.getGameState().selectableTiles.find((function(e){return e.equals(t)}))){var e={type:ut.SELECT_TILE,tile:t};this.delegate.onAction(e)}else this.delegate.setToastText("Can't move character here")},t.prototype.tryThrowingGrenade=function(t){if(this.delegate.getGameState().selectableTiles.find((function(e){return e.equals(t)}))){var e={type:ut.SELECT_TILE,tile:t};this.delegate.onAction(e)}else this.delegate.setToastText("Can't throw grenade here")},t.prototype.addSwitchSquadMemberControls=function(){var t,e,n=this,a=this.delegate.getGameState().getActiveSquad();this.gameClickHandler={onClick:function(t){n.trySelectingCharacter(t)}};var r=function(t){if(t.index>=9)return"continue";var e=t.index+1,a=g.get(e);if(null==a)throw new Error("Not enough keys for all character numbers!");o.controlMap.add({key:a,name:"Select "+m.get(e)+" character",func:function(){var e={type:ut.SELECT_CHARACTER,characterIndex:t.index};n.delegate.onAction(e)},eventType:l.KeyPress})},o=this;try{for(var s=i(a),c=s.next();!c.done;c=s.next()){r(c.value)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}},t.prototype.addDefaultControls=function(){var t=this,e={key:pe,name:"Pause",func:function(){t.togglePause()},eventType:l.KeyPress};this.controlMap.add(e),this.buttonPanel.setBottomButtons([e])},t.prototype.addQuitAndRestartControls=function(t){var e,n,a=this;void 0===t&&(t=!1);var r=[];t||r.push({key:pe,name:"Resume",func:function(){a.togglePause(),a.controlMap.remove(pe),a.addDefaultControls()},eventType:l.KeyPress}),r.push({key:ve,name:"Restart",func:this.delegate.onRestart,eventType:l.KeyPress},{key:Te,name:"Quit",func:this.delegate.onQuit,eventType:l.KeyPress});try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var c=s.value;this.controlMap.add(c)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}this.buttonPanel.setBottomButtons(r)},t.prototype.addCharacterClassControls=function(){var t,e,n=this,a=[],r=function(t){var e=Re.get(t),r={key:t,name:e,func:function(){var t={type:ut.SELECT_CHARACTER_CLASS,class:Pe(e)};n.delegate.onAction(t);var a=s(Re.values()).findIndex((function(t){return e===t}));n.buttonPanel.selectIndex(a);var r=De(e);n.buttonPanel.setDescription(r)},eventType:l.KeyPress};a.push(r),o.controlMap.add(r)},o=this;try{for(var c=i(Re.keys()),y=c.next();!y.done;y=c.next()){r(y.value)}}catch(e){t={error:e}}finally{try{y&&!y.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}this.buttonPanel.configurePanel({headerTextLines:["Select Character","Class to Place"],buttonInfos:a,isButtonGroup:!0}),this.buttonPanel.setDescription(De(Mt[0].type))},t.prototype.togglePause=function(){var t=!this.delegate.isPaused();this.delegate.onTogglePause(),t?(this.controlMap.remove(pe),this.addQuitAndRestartControls()):(this.controlMap.remove(Te),this.controlMap.remove(ve))},t}();function Pe(t){return Mt.find((function(e){return e.type===t}))}function De(t){var e=Pe(t);return s(["HP: "+e.maxHealth,"Moves: "+e.maxMovesPerTurn,"Sight: "+e.maxSight,"","Gun:"],Fe(e.gun).map((function(t){return"  "+t})),["","Abilities:"],function(t){var e,n,a=[];try{for(var r=i(t),o=r.next();!o.done;o=r.next()){var l=o.value;a.push(""),a.push.apply(a,s(ke(l)))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return a}(s(e.extraActions)).map((function(t){return"  "+t})))}function Fe(t){var e=[];if(t.projectileDetails.type===yt.BULLET){var n=t.spray?"(x"+t.spray.projectiles+")":"";e=["Projectile type: bullet","Damage: "+t.projectileDetails.damage+n,"Max ricochets: "+t.projectileDetails.numRicochets]}else e=["Projectile type: explosive","Damage: "+t.projectileDetails.damage,"Damage radius: "+t.projectileDetails.damageManhattanDistanceRadius,"Max ricochets: "+t.projectileDetails.numRicochets];var a=s(e);return t.canFireAfterMoving||a.push("Can't shoot after moving"),a}function ke(t){var e=[];return t.abilityType===dt.HEAL?e.push("Heal","  Heal amount: "+t.healAmount):e.push("Grenade","  Damage: "+t.splashDamage.damage,"  Damage radius: "+t.splashDamage.damageManhattanDistanceRadius,"  Range: "+t.maxManhattanDistance),e.push("  Max uses: "+t.maxUses),t.maxUses>1&&e.push("  Cooldown turns: "+t.cooldownTurns),t.isFree?e.push("  Can also shoot"):e.push("  Can't use and shoot"),e}var Oe,He=n.p+"7252df4f170f3c3fcf46805b0396a23c.jpg",Ne=function(){function t(t,e,n){var a=this;this.blackWoodTexture=new Zt(He),this.onAnimationDone=null,this.gameDelegate={getCurrentAimPath:function(t){var e=a.gameState.getAliveCharacters();return a.gameState.settings.hasFogOfWar&&e.filter((function(t){return a.gameState.isTileVisibleByTeamIndex(t.tileCoords,a.gameState.currentTeamIndex)})),Kt(r(r({},t),{characters:e,obstacles:a.gameState.obstacles}))}},this.onProjectileAnimationOver=function(){a.checkGameOver(),a.isGameOver||a.checkCharacterTurnOver()},this.resetGame=function(){a.destroy(),a.gameState=new ee(a.gameSettings),a.loadLevel(),a.isGameOver=!1,a.isPaused=!1,a.onAnimationDone=null,a.winningTeamIndex=-1,a.gameState.gamePhase=Yt.CHARACTER_PLACEMENT,a.selectedCharacterSettings=Mt[0],a.gameState.characters=[],a.projectiles=[],a.particleSystems=[],a.ais=[],a.teamIndexToIsAi=[];for(var t=a.gameSettings.matchType,e=0;e<a.gameSettings.numTeams;e++){var n=0!==e;t===I.AI_VS_AI?n=!0:t===I.PLAYER_VS_PLAYER_LOCAL&&(n=!1),a.teamIndexToIsAi.push(n),n&&a.ais.push(new ce({teamIndex:e,difficulty:a.gameState.settings.aiDifficulty}))}a.hud=new Ut(a.context),a.inputManager=new _e(a.context,{isPaused:function(){return a.isPaused},getGameState:function(){return a.getGameState()},onAction:function(t){a.onAction(t)},onRestart:function(){a.resetGame()},onQuit:function(){a.onExitGameCallback(a.winningTeamIndex)},onTogglePause:function(){a.togglePause()},setToastText:function(t){a.hud.setText(t,Ht.TOAST,Ot.SHORT)}}),a.gameState.currentTeamIndex=-1,a.nextTurn()},this.canvas=t,this.context=e,this.gameSettings=n.gameSettings,this.levelIndex=n.levelIndex,this.onExitGameCallback=n.onExitGameCallback,this.resetGame()}return t.prototype.isAnimating=function(){return s(this.gameState.getAliveCharacters(),this.projectiles).some((function(t){return t.animationState.isAnimating}))},t.prototype.update=function(t){var e,n,a,r,o,s;if(this.inputManager.update(t),!this.isPaused){try{for(var l=i(this.particleSystems),c=l.next();!c.done;c=l.next()){c.value.update(t)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}this.particleSystems=this.particleSystems.filter((function(t){return t.isAlive}));try{for(var y=i(this.projectiles),h=y.next();!h.done;h=y.next()){var u=h.value;this.updateProjectile(t,u)}}catch(t){a={error:t}}finally{try{h&&!h.done&&(r=y.return)&&r.call(y)}finally{if(a)throw a.error}}this.projectiles=this.projectiles.filter((function(t){return!t.isDead||!t.isTrailGone()}));try{for(var x=i(this.gameState.getAliveCharacters()),d=x.next();!d.done;d=x.next()){var f=d.value;f.update(t),f.animationState.isAnimating&&this.shouldSkipAnimation(f)&&f.skipAnimation()}}catch(t){o={error:t}}finally{try{d&&!d.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}if(this.hud.update(t),this.isAnimating()||null==this.onAnimationDone||(this.onAnimationDone(),this.onAnimationDone=null),(this.gameState.gamePhase===Yt.CHARACTER_PLACEMENT||0!==this.gameState.getActiveSquad().filter((function(t){return!t.isTurnOver()})).length)&&this.isAiTurn()&&!this.isAnimating()){var g=this.getCurrentTurnAi().getNextAction(this.getGameState());this.onAction(g)}}},t.prototype.updateProjectile=function(t,e){var n,a,r,o;if(e.update(t),!e.isDead&&e.isAtFinalTarget()){var s=e.getCurrentTarget(),l=s.canvasCoords;if(e.projectileDetails.type===yt.SPLASH){var c=e.projectileDetails;this.particleSystems.push(new Gt({startPositionCanvas:l,particleCount:160,colorA:"#a1a1a1",colorB:"#403f3f",shape:gt.CIRCLE,minParticleSpeed:5e-4*E.TILE_SIZE,maxParticleSpeed:.001*E.TILE_SIZE,minLifetimeMs:800,maxLifetimeMs:100,minRadius:.055*E.TILE_SIZE,maxRadius:.085*E.TILE_SIZE})),this.particleSystems.push(new Gt(function(t){return{startPositionCanvas:t,particleCount:100,colorA:"#e3a14f",colorB:"#6e6151",shape:gt.ELLIPSE,minParticleSpeed:.0015*E.TILE_SIZE,maxParticleSpeed:.0025*E.TILE_SIZE,minLifetimeMs:500,maxLifetimeMs:600,minRadius:.035*E.TILE_SIZE,maxRadius:.055*E.TILE_SIZE}}(l)));var y=A({startTile:s.tile,maxDepth:c.damageManhattanDistanceRadius,isAvailable:function(t){return!0},canGoThrough:function(t){return!0}}),h=function(t){var e=u.gameState.getAliveCharacters().find((function(e){return e.tileCoords.equals(t)}));if(e){var n=e.tileCoords.manhattanDistanceTo(s.tile),a=Math.pow(c.tilesAwayDamageReduction,n),r=c.damage*a;e.health-=r}},u=this;try{for(var x=i(y),d=x.next();!d.done;d=x.next()){h(d.value)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}}else{var f=this.gameState.getAliveCharacters().find((function(t){return t.tileCoords.equals(s.tile)}));f&&f!==this.gameState.selectedCharacter&&!s.isTargetGridBorder&&(f.health-=e.projectileDetails.damage),this.particleSystems.push(new Gt(function(t){return{startPositionCanvas:t,particleCount:60,colorA:"#a83232",colorB:"#cc7606",shape:gt.LINE,minParticleSpeed:.003*E.TILE_SIZE,maxParticleSpeed:.005*E.TILE_SIZE,minLifetimeMs:100,maxLifetimeMs:200,minRadius:.035*E.TILE_SIZE,maxRadius:.065*E.TILE_SIZE}}(l)))}e.setIsDead();try{for(var g=i(this.projectiles.filter((function(t){return!t.isDead}))),m=g.next();!m.done;m=g.next()){var p=m.value,T=p.getCurrentTarget().ray,v=Kt({ray:T,startingTileCoords:E.getTileFromCanvasCoords(T.startPt),fromTeamIndex:p.fromTeamIndex,numRicochets:p.getNumRicochetsLeft(),characters:this.gameState.getAliveCharacters(),obstacles:this.gameState.obstacles});p.setNewTargets(v)}}catch(t){r={error:t}}finally{try{m&&!m.done&&(o=g.return)&&o.call(g)}finally{if(r)throw r.error}}}},t.prototype.shouldSkipAnimation=function(t){return!!this.isAiTurn()&&this.gameState.settings.matchType===I.AI_VS_AI},t.prototype.render=function(){var t,e,n,r,o,s,l,c,y,h,u,x,d,f,g=this.context;if(g.fillStyle=L,g.clearRect(0,0,a.canvasWidth,a.canvasHeight),g.fillRect(0,0,a.canvasWidth,a.canvasHeight),P&&this.blackWoodTexture.tryDrawing({context:g,sourceX:0,sourceY:0,sourceWidth:E.GAME_WIDTH,sourceHeight:E.GAME_HEIGHT,canvasX:0,canvasY:0,canvasWidth:E.GAME_WIDTH,canvasHeight:E.GAME_HEIGHT}),null!=this.gameState.selectableTiles&&this.gameState.selectableTiles.length){if(!this.isAiTurn())try{for(var m=i(this.gameState.selectableTiles),T=m.next();!T.done;T=m.next()){var v=T.value,S=E.getCanvasFromTileCoords(v);g.fillStyle=U,g.fillRect(S.x,S.y,E.TILE_SIZE,E.TILE_SIZE)}}catch(e){t={error:e}}finally{try{T&&!T.done&&(e=m.return)&&e.call(m)}finally{if(t)throw t.error}}var C=E.getTileFromCanvasCoords(p.getMouseCanvasCoords());if(this.gameState.selectableTiles.find((function(t){return t.equals(C)}))){S=E.getCanvasFromTileCoords(C);g.fillStyle=z,g.fillRect(S.x,S.y,E.TILE_SIZE,E.TILE_SIZE)}}try{for(var A=i(this.gameState.obstacles),I=A.next();!I.done;I=A.next()){I.value.render(g)}}catch(t){n={error:t}}finally{try{I&&!I.done&&(r=A.return)&&r.call(A)}finally{if(n)throw n.error}}try{for(var w=i(this.gameState.flags),M=w.next();!M.done;M=w.next()){M.value.render(this.context)}}catch(t){o={error:t}}finally{try{M&&!M.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}try{for(var b=i(this.gameState.getAliveCharacters()),R=b.next();!R.done;R=b.next()){var _=R.value;this.shouldRenderCharacter(_)&&_.render(this.context)}}catch(t){l={error:t}}finally{try{R&&!R.done&&(c=b.return)&&c.call(b)}finally{if(l)throw l.error}}try{for(var D=i(this.gameState.spawners),F=D.next();!F.done;F=D.next()){F.value.render(this.context)}}catch(t){y={error:t}}finally{try{F&&!F.done&&(h=D.return)&&h.call(D)}finally{if(y)throw y.error}}if(null!=this.gameState.selectedCharacter&&!this.isAiTurn()){S=E.getCanvasFromTileCoords(this.gameState.selectedCharacter.tileCoords);g.strokeStyle=W,g.lineWidth=2,g.strokeRect(S.x,S.y,E.TILE_SIZE,E.TILE_SIZE)}try{for(var k=i(this.projectiles),O=k.next();!O.done;O=k.next()){var H=O.value;this.shouldRenderObjectAtTile(H.tileCoords)&&H.render()}}catch(t){u={error:t}}finally{try{O&&!O.done&&(x=k.return)&&x.call(k)}finally{if(u)throw u.error}}try{for(var N=i(this.particleSystems),G=N.next();!G.done;G=N.next()){var B=G.value;this.shouldRenderObjectAtTile(B.tileCoords)&&B.render(this.context)}}catch(t){d={error:t}}finally{try{G&&!G.done&&(f=N.return)&&f.call(N)}finally{if(d)throw d.error}}this.renderFogOfWar(this.context),this.hud.render(),this.inputManager.render()},t.prototype.shouldRenderCharacter=function(t){if(!this.gameState.isFogOfWarOn())return!0;if(this.gameState.settings.matchType===I.PLAYER_VS_PLAYER_LOCAL||this.gameState.settings.matchType===I.AI_VS_AI)return this.gameState.isTileVisibleByTeamIndex(t.tileCoords,this.gameState.currentTeamIndex);if(0===t.teamIndex)return!0;var e=E.getTileFromCanvasCoords(t.animationState.currentCenterCanvas);return this.gameState.isTileVisibleByTeamIndex(e,0)},t.prototype.shouldRenderObjectAtTile=function(t){return!this.gameState.isFogOfWarOn()||(this.gameState.settings.matchType===I.PLAYER_VS_PLAYER_LOCAL||this.gameState.settings.matchType===I.AI_VS_AI?this.gameState.isTileVisibleByTeamIndex(t,this.gameState.currentTeamIndex):this.gameState.isTileVisibleByTeamIndex(t,0))},t.prototype.renderFogOfWar=function(t){if(this.gameState.isFogOfWarOn()){var e=[];this.gameState.settings.matchType===I.PLAYER_VS_PLAYER_LOCAL||this.gameState.settings.matchType===I.AI_VS_AI?e=this.gameState.getTilesVisibleByTeamIndex(this.gameState.currentTeamIndex):this.gameState.settings.matchType===I.PLAYER_VS_AI&&(e=this.gameState.getTilesVisibleByTeamIndex(0)),this.gameState.gamePhase!==Yt.CHARACTER_PLACEMENT||this.isAiTurn()||(e=e.concat(this.gameState.selectableTiles)),t.fillStyle=_;for(var n=0;n<E.TILES_WIDE;n++)for(var a=function(a){var r=new y(n,a);if(e.find((function(t){return t.equals(r)})))return"continue";var i=E.getCanvasFromTileCoords(r);t.fillRect(i.x,i.y,E.TILE_SIZE,E.TILE_SIZE)},r=0;r<E.TILES_TALL;r++)a(r)}},t.prototype.destroy=function(){this.inputManager&&this.inputManager.clear()},t.prototype.onAction=function(t){var e,n;if(!this.isPaused){var a=this.gameState.getActiveSquad();switch(t.type){case ut.SHOOT:if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on FIRE action");var r=this.gameState.selectedCharacter.shoot();try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var l=s.value;this.fireShot(l),this.addOnAnimationDoneCallback(this.onProjectileAnimationOver)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}break;case ut.HEAL:if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on HEAL action");this.gameState.selectedCharacter.regenHealth(t.healAmount),this.gameState.selectedCharacter.useAbility(dt.HEAL);var c=E.getCanvasFromTileCoords(this.gameState.selectedCharacter.tileCoords).add(E.HALF_TILE);this.particleSystems.push(new Gt({startPositionCanvas:c,particleCount:12,colorA:"#1bd133",colorB:"#07ad1d",shape:gt.PLUS,minParticleSpeed:.001*E.TILE_SIZE,maxParticleSpeed:.002*E.TILE_SIZE,minLifetimeMs:600,maxLifetimeMs:800,minRadius:.07*E.TILE_SIZE,maxRadius:.12*E.TILE_SIZE})),this.checkCharacterTurnOver();break;case ut.END_CHARACTER_TURN:if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on END_CHARACTER_TURN action");this.gameState.selectedCharacter.setTurnOver(),this.onCharacterTurnOver();break;case ut.AIM:if(null==this.gameState.selectedCharacter)throw new Error("No selected character when trying to aim");this.gameState.selectedCharacter.setAim(t.aimAngleClockwiseRadians);break;case ut.SELECT_TILE:if(!this.gameState.selectableTiles.find((function(e){return e.equals(t.tile)})))throw new Error("Invalid tile selection: "+t.tile.toString());if(this.gameState.gamePhase===Yt.COMBAT){if(null==this.gameState.selectedCharacter)throw new Error("Selected character is null on SELECT_TILE action in combat phase");if(this.gameState.selectableTiles=[],this.gameState.selectedCharacterState===Qt.MOVING)this.handleCharacterMovement(t.tile);else if(this.gameState.selectedCharacterState===Qt.THROWING_GRENADE){var y={splashDamage:this.gameState.selectedCharacter.getGrenadeAbility().splashDamage,tile:t.tile};this.gameState.selectedCharacter.useAbility(dt.THROW_GRENADE),this.throwGrenade(y)}}else{var h=a.length;this.gameState.characters.push(new $t({startCoords:t.tile,teamIndex:this.gameState.currentTeamIndex,index:h,settings:this.selectedCharacterSettings,gameDelegate:this.gameDelegate}));var u=this.gameSettings.teamIndexToSquadSize.get(this.gameState.currentTeamIndex);a.length+1===u?this.nextTurn():this.gameState.selectableTiles=this.gameState.selectableTiles.filter((function(e){return!e.equals(t.tile)}))}break;case ut.SELECT_CHARACTER:var x=a.find((function(e){return e.index===t.characterIndex}));if(null==x)throw new Error("Can't find character in SELECT_CHARACTER action. cur team index: "+this.gameState.currentTeamIndex+";  charIndex: "+t.characterIndex);if(x.isTurnOver()||!x.isAlive())throw new Error("Selected character is dead or turn is over.");this.gameState.selectedCharacter.cancelAiming(),this.setSelectedCharacter(t.characterIndex);break;case ut.SELECT_CHARACTER_STATE:this.setSelectedCharacterState(t.state);break;case ut.SELECT_CHARACTER_CLASS:this.selectedCharacterSettings=t.class;break;default:!function(t){throw new Error("Action not handled")}()}}},t.prototype.checkGameOver=function(){if(this.gameState.spawners.length>0&&0!==this.gameState.getCharactersForTeamIndex(0).length)return;var t=null,e=-1;0===this.gameState.getEnemyCharacters().length?(e=this.gameState.currentTeamIndex,t=this.gameState.getActiveTeamName()):0===this.gameState.getActiveSquad().length&&(t=this.gameState.getEnemyTeamName(),e=(1+this.gameState.currentTeamIndex)%this.gameSettings.numTeams),null!=t&&this.setGameOver(e,t+" has elimanted all oponents.")},t.prototype.checkCharacterTurnOver=function(){this.gameState.selectedCharacter.isTurnOver()?this.onCharacterTurnOver():this.setSelectedCharacterState(Qt.AWAITING)},t.prototype.onCharacterTurnOver=function(){var t=this.gameState.getActiveSquad().find((function(t){return!t.isTurnOver()&&t.isAlive()}));t?this.setSelectedCharacter(t.index):this.nextTurn()},t.prototype.nextTurn=function(){this.gameState.gamePhase===Yt.CHARACTER_PLACEMENT?this.gameState.currentTeamIndex+1<this.gameSettings.numTeams?(this.gameState.currentTeamIndex+=1,this.initCharacterPlacementTurn()):(this.gameState.gamePhase=Yt.COMBAT,this.advanceToNextCombatTurn()):this.advanceToNextCombatTurn()},t.prototype.isAiTurn=function(){return!this.isGameOver&&this.teamIndexToIsAi[this.gameState.currentTeamIndex]},t.prototype.initCharacterPlacementTurn=function(){this.gameState.selectableTiles=this.getAvailableTilesForCharacterPlacement();var t=this.gameState.getActiveTeamName(),e=this.gameSettings.teamIndexToSquadSize.get(this.gameState.currentTeamIndex);this.hud.setText(t+" team turn",Ht.TITLE,Ot.LONG),this.hud.setText("Place squad members ("+e+" remaining) ",Ht.SUBTITLE,Ot.LONG),this.isAiTurn()?this.inputManager.initDefaultControls():this.inputManager.initForCharacterPlacement()},t.prototype.advanceToNextCombatTurn=function(){var t,e,n,a,r=this.gameState.currentTeamIndex;try{for(var o=i(this.gameState.spawners),s=o.next();!s.done;s=o.next()){var l=s.value;if(l.teamIndex===r){l.advanceTurn();var c=this.gameState.characters.filter((function(t){return t.teamIndex===r})).length;if(l.checkAndHandleRespawn()){var y=new $t({startCoords:l.tileCoords,teamIndex:this.gameState.currentTeamIndex,index:c,settings:this.selectedCharacterSettings,gameDelegate:this.gameDelegate});this.gameState.characters.push(y)}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}this.gameState.currentTeamIndex=(this.gameState.currentTeamIndex+1)%this.gameSettings.numTeams;var h=this.gameState.getActiveSquad();if(0!==h.length){try{for(var u=i(h),x=u.next();!x.done;x=u.next()){(y=x.value).resetTurnState()}}catch(t){n={error:t}}finally{try{x&&!x.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}var d=this.gameState.getActiveTeamName();this.setSelectedCharacter(this.gameState.getFirstCharacterIndex()),this.hud.setText(d+" team turn",Ht.TITLE,Ot.LONG)}else this.advanceToNextCombatTurn()},t.prototype.getCurrentTurnAi=function(){var t=this;return this.ais.find((function(e){return e.teamIndex===t.gameState.currentTeamIndex}))},t.prototype.getGameState=function(){return this.gameState},t.prototype.addOnAnimationDoneCallback=function(t){this.onAnimationDone=t,this.inputManager.initDefaultControls()},t.prototype.handleCharacterMovement=function(t){var e=this,n=this.gameState.selectedCharacter;if(n.tileCoords.manhattanDistanceTo(t)>n.settings.maxMovesPerTurn)throw new Error("Invalid character movement location (too far): start: "+n.tileCoords.toString()+", end: "+t.toString());var a=this.gameState.getPath({from:n.tileCoords,to:t}),r=function(t,e){var n,a,r=[],o=t,s=function(t){return E.getCanvasFromTileCoords(t).add(E.HALF_TILE)},l=s(o);try{for(var c=i(e),y=c.next();!y.done;y=c.next()){var h=y.value,u=s(h),x=u.subtract(l).normalize(),d={ray:new ot(l,x),canvasCoords:u,tile:h,maxDistance:l.distanceTo(u)};o=h,l=u,r.push(d)}}catch(t){n={error:t}}finally{try{y&&!y.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return r}(n.tileCoords,a),o=this.gameState.getEnemyFlag(),s=this.gameState.getActiveTeamFlag(),l=n.tileCoords.equals(o.tileCoords);n.moveTo(t,r),this.addOnAnimationDoneCallback((function(){s.isAtStart()&&o.tileCoords.equals(s.tileCoords)?e.setGameOver(e.gameState.currentTeamIndex,e.gameState.getActiveTeamName()+" team has snagged the flag."):e.checkCharacterTurnOver()})),l?(o.setIsTaken((function(){return n.animationState.currentCenterCanvas.subtract(E.HALF_TILE)})),o.tileCoords=t):o.tileCoords.equals(t)&&this.hud.setText(this.gameState.getActiveTeamName()+" team has taken the flag.",Ht.SUBTITLE,Ot.SHORT),!s.isAtStart()&&s.tileCoords.equals(t)&&(s.returnToStart(),this.hud.setText(this.gameState.getActiveTeamName()+" team has returned their flag.",Ht.SUBTITLE,Ot.SHORT))},t.prototype.setGameOver=function(t,e){this.inputManager.initGameOverControls(),this.togglePause(),this.isGameOver=!0,this.winningTeamIndex=t,this.hud.setText("Game over",Ht.TITLE,Ot.LONG),this.hud.setText(""+e,Ht.SUBTITLE,Ot.LONG)},t.prototype.fireShot=function(t){var e=jt(t),n=t.projectileDetails.type===yt.BULLET?t.projectileDetails.numRicochets:0,a=Kt({ray:e,startingTileCoords:t.fromTileCoords,fromTeamIndex:t.fromTeamIndex,numRicochets:n,characters:this.gameState.getAliveCharacters(),obstacles:this.gameState.obstacles});re.log(te.TARGET_FINDING,"Targets: "+JSON.stringify(a)),this.projectiles.push(new Pt({context:this.context,projectileDetails:t.projectileDetails,targets:a,fromTeamIndex:t.fromTeamIndex}))},t.prototype.throwGrenade=function(t){var e=this.gameState.selectedCharacter.tileCoords,n=E.getCanvasFromTileCoords(e).add(E.HALF_TILE),a=t.tile,r=E.getCanvasFromTileCoords(a).add(E.HALF_TILE),i=r.subtract(n).normalize(),o={canvasCoords:r,ray:new ot(n,i),tile:a,maxDistance:r.distanceTo(n)},s={fromTeamIndex:this.gameState.selectedCharacter.teamIndex,fromCanvasCoords:n,fromTileCoords:e,aimAngleRadiansClockwise:i.getPointRotationRadians(),projectileDetails:t.splashDamage},l=new Pt({context:this.context,projectileDetails:s.projectileDetails,targets:[o],fromTeamIndex:s.fromTeamIndex});this.projectiles.push(l),this.addOnAnimationDoneCallback(this.onProjectileAnimationOver)},t.prototype.getAvailableTilesForCharacterPlacement=function(){var t=this,e=this.gameState.getActiveTeamFlag().tileCoords,n=this.gameSettings.maxSpawnDistanceFromFlag;return A({startTile:e,maxDepth:n,isAvailable:function(n){return!t.isTileOccupied(n)&&!n.equals(e)},canGoThrough:function(e){return!t.gameState.tileHasObstacle(e)}})},t.prototype.getAvailableTilesForCharacterMovement=function(){var t=this;if(null==this.gameState.selectedCharacter)throw new Error("No character selected in getAvailableTilesForCharacterMovement");var e=this.gameState.getActiveTeamFlag(),n=this.gameState.getActiveTeamFlag().tileCoords,a=this.gameState.selectedCharacter.tileCoords,r=this.gameState.selectedCharacter.settings.maxMovesPerTurn,i=function(a){return!t.isTileOccupied(a)&&(!!t.gameState.selectedCharacter.tileCoords.equals(t.gameState.getEnemyFlag().tileCoords)||(!e.isAtStart()||!a.equals(n)))};return A({startTile:a,maxDepth:r,isAvailable:i,canGoThrough:function(e){return i(e)||t.gameState.isSquadMemberAtTile(e)}})},t.prototype.getAvailableTilesForThrowingGrenade=function(){var t=this;if(null==this.gameState.selectedCharacter)throw new Error("No character selected in getAvailableTilesForThrowingGrenade");this.gameState.getActiveTeamFlag();var e=this.gameState.selectedCharacter.tileCoords,n=this.gameState.selectedCharacter.getGrenadeAbility().maxManhattanDistance;return A({startTile:e,maxDepth:n,isAvailable:function(n){return!t.gameState.tileHasObstacle(n)&&!n.equals(e)&&!t.gameState.isSquadMemberAtTile(n)},canGoThrough:function(t){return E.inbounds(t)}})},t.prototype.setSelectedCharacter=function(t){var e=this.gameState.getActiveSquad().find((function(e){return e.index===t}));e.isTurnOver()?this.hud.setText("Unit "+(t+1)+"'s turn is over.",Ht.TOAST,Ot.SHORT):(this.gameState.selectedCharacter=e,this.setSelectedCharacterState(Qt.AWAITING))},t.prototype.setSelectedCharacterState=function(t){if(null==this.gameState.selectedCharacter)throw new Error("There needs to be a selected character before calling setSelectedCharacterState");switch(this.gameState.selectedCharacterState=t,t){case Qt.AWAITING:this.gameState.selectableTiles=[],this.gameState.selectedCharacter.cancelAiming();break;case Qt.MOVING:this.gameState.selectableTiles=this.getAvailableTilesForCharacterMovement();break;case Qt.AIMING:this.gameState.selectedCharacter.startAiming();break;case Qt.THROWING_GRENADE:this.gameState.selectableTiles=this.getAvailableTilesForThrowingGrenade();break;default:throw new Error("Unknown selected character state")}this.isAiTurn()?this.inputManager.initDefaultControls():this.inputManager.initForSelectedCharacterState()},t.prototype.isTileOccupied=function(t){var e=this.gameState.obstacles.find((function(e){return e.tileCoords.equals(t)})),n=this.gameState.getAliveCharacters().find((function(e){return e.isAlive()&&e.tileCoords.equals(t)})),a=this.gameState.spawners.find((function(e){return e.tileCoords.equals(t)}));return null!=e||null!=n||null!=a},t.prototype.loadLevel=function(){var t=at[this.levelIndex],e=new bt({tileCoords:u(t.data.blueFlag),teamIndex:0}),n=new bt({tileCoords:u(t.data.redFlag),teamIndex:1});if(this.gameState.flags=[e,n],this.gameState.obstacles=t.data.obstacles.map((function(t){return new qt(u(t))})),this.gameState.spawners=[],this.gameState.settings.hasSpawners){var a=new Map([[w.WEAK,8],[w.MEDIUM,6],[w.STRONG,5]]),r={tileCoords:u(t.aiSpawner),teamIndex:1,turnsBetweenSpawns:a.get(this.gameState.settings.aiDifficulty)};this.gameState.spawners.push(new ue(r))}},t.prototype.togglePause=function(){this.isPaused=!this.isPaused,this.isPaused?this.hud.setText("PAUSED",Ht.TITLE,Ot.SHORT):(this.hud.clearText(Ht.TITLE),this.hud.clearText(Ht.TOAST))},t}();!function(t){t[t.BLUE_FLAG=0]="BLUE_FLAG",t[t.RED_FLAG=1]="RED_FLAG",t[t.OBSTACLE=2]="OBSTACLE",t[t.ERASE=3]="ERASE"}(Oe||(Oe={}));var Ge=function(){function t(t,e,n){var a=this;this.saveLevel=function(){if(null==a.blueFlag||null==a.redFlag)throw new Error("Need to add both flags!");var t={redFlag:a.redFlag.tileCoords,blueFlag:a.blueFlag.tileCoords,obstacles:a.obstacles.map((function(t){return t.tileCoords}))};console.log(JSON.stringify(t))},this.resetGame=function(){a.destroy(),a.placementMode=Oe.OBSTACLE,a.obstacles=[],a.redFlag=void 0,a.blueFlag=void 0,a.controlMap=new d,a.controlMap.add({key:x.Q,name:"Quit",func:a.onExitGameCallback,eventType:l.KeyPress}),a.controlMap.add({key:x.R,name:"Reset",func:a.resetGame,eventType:l.KeyPress}),a.controlMap.add({key:x.S,name:"Save",func:a.saveLevel,eventType:l.KeyPress}),a.controlMap.add({key:x.O,name:"Place Obstacles",func:function(){a.setPlacementMode(Oe.OBSTACLE)},eventType:l.KeyPress}),a.controlMap.add({key:x.B,name:"Place Blue Flag",func:function(){a.setPlacementMode(Oe.BLUE_FLAG)},eventType:l.KeyPress}),a.controlMap.add({key:x.V,name:"Place Red Flag",func:function(){a.setPlacementMode(Oe.RED_FLAG)},eventType:l.KeyPress}),a.controlMap.add({key:x.E,name:"Erase",func:function(){a.setPlacementMode(Oe.ERASE)},eventType:l.KeyPress})},this.canvas=t,this.context=e,this.onExitGameCallback=n,this.resetGame()}return t.prototype.update=function(t){if(this.controlMap.check(),p.hasClick()){var e=p.handleClick(),n=E.getTileFromCanvasCoords(e);if(this.isTileOccupied(n))this.placementMode===Oe.ERASE&&this.removeObjectInTile(n);else switch(this.placementMode){case Oe.BLUE_FLAG:this.blueFlag=new bt({tileCoords:n,teamIndex:0});break;case Oe.RED_FLAG:this.redFlag=new bt({tileCoords:n,teamIndex:1});break;case Oe.OBSTACLE:var a=new qt(n);this.obstacles.push(a)}}},t.prototype.isTileOccupied=function(t){return!(null==this.redFlag||!this.redFlag.tileCoords.equals(t))||(!(null==this.blueFlag||!this.blueFlag.tileCoords.equals(t))||null!=this.obstacles.find((function(e){return e.tileCoords.equals(t)})))},t.prototype.removeObjectInTile=function(t){null!=this.redFlag&&this.redFlag.tileCoords.equals(t)&&(this.redFlag=void 0),null!=this.blueFlag&&this.blueFlag.tileCoords.equals(t)&&(this.blueFlag=void 0),this.obstacles=this.obstacles.filter((function(e){return!e.tileCoords.equals(t)}))},t.prototype.render=function(){var t,e,n=this.context,a=E.GAME_WIDTH,r=E.GAME_HEIGHT;n.fillStyle=L,n.clearRect(0,0,a,r),n.fillRect(0,0,a,r);for(var o=0;o<E.TILES_WIDE;o++){var s=y=o*E.TILE_SIZE,l=0,c=r;n.beginPath(),n.strokeStyle=M,n.moveTo(y,l),n.lineTo(s,c),n.stroke()}for(o=0;o<E.TILES_TALL;o++){var y=0;s=a,c=l=o*E.TILE_SIZE;n.beginPath(),n.strokeStyle=M,n.moveTo(y,l),n.lineTo(s,c),n.stroke()}var h=E.getTileFromCanvasCoords(p.getMouseCanvasCoords()),u=E.getCanvasFromTileCoords(h);if(E.inbounds(h)&&this.placementMode!==Oe.ERASE&&!this.isTileOccupied(h)){var x=E.getCanvasFromTileCoords(h),d=D;this.placementMode===Oe.RED_FLAG?d=k:this.placementMode===Oe.BLUE_FLAG&&(d=O);var f=Ft(d);f.a=.7,n.fillStyle=kt(f),n.fillRect(x.x,x.y,E.TILE_SIZE,E.TILE_SIZE)}try{for(var g=i(this.obstacles),m=g.next();!m.done;m=g.next()){m.value.render(n)}}catch(e){t={error:e}}finally{try{m&&!m.done&&(e=g.return)&&e.call(g)}finally{if(t)throw t.error}}null!=this.redFlag&&this.redFlag.render(this.context),null!=this.blueFlag&&this.blueFlag.render(this.context),this.placementMode===Oe.ERASE&&this.isTileOccupied(h)&&(n.fillStyle="#000000",n.fillRect(u.x,u.y,E.TILE_SIZE,E.TILE_SIZE)),this.renderControls()},t.prototype.renderControls=function(){var t,e,n=this.context;n.fillStyle=R;n.font="18px fantasy";var r=new y(a.canvasWidth/64,a.canvasHeight/32);try{for(var o=i(this.controlMap.assignedControls.keys()),s=o.next();!s.done;s=o.next()){var l=s.value,c=p.getAssignedControlMap().get(l);n.fillText(p.getStringForKey(l)+" - "+c,r.x,r.y),r=r.add(new y(0,22))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t.prototype.destroy=function(){this.controlMap&&this.controlMap.clear()},t.prototype.setPlacementMode=function(t){this.placementMode=t},t}(),Be=[{levelIndex:0,levelName:"Starting grounds",teamIndexToSquadSize:new Map([[0,4],[1,4]]),isUnlocked:!0,aiDifficulty:w.WEAK},{levelIndex:1,levelName:"Getting tougher",teamIndexToSquadSize:new Map([[0,3],[1,5]]),isUnlocked:!1,aiDifficulty:w.WEAK},{levelIndex:7,levelName:"Protect it",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.WEAK},{levelIndex:3,levelName:"Snag it",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.WEAK},{levelIndex:8,levelName:"Familiar",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:9,levelName:"Snarls",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:6,levelName:"To snag...",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:2,levelName:"Or be snagged...",teamIndexToSquadSize:new Map([[0,4],[1,8]]),isUnlocked:!1,aiDifficulty:w.MEDIUM},{levelIndex:4,levelName:"Snag and tag",teamIndexToSquadSize:new Map([[0,6],[1,16]]),isUnlocked:!1,aiDifficulty:w.STRONG},{levelIndex:5,levelName:"Flag of snag",teamIndexToSquadSize:new Map([[0,8],[1,24]]),isUnlocked:!1,aiDifficulty:w.STRONG},{levelIndex:10,levelName:"Frag and flag",teamIndexToSquadSize:new Map([[0,8],[1,24]]),isUnlocked:!1,aiDifficulty:w.STRONG},{levelIndex:11,levelName:"Final snag",teamIndexToSquadSize:new Map([[0,6],[1,16]]),isUnlocked:!1,aiDifficulty:w.STRONG}];function We(){var t=window.localStorage.getItem("SnagTheFlag_Campgain_LastUnlockedCampaignLevelIndex");return null!=t?Number.parseInt(t):-1}!function(){for(var t=We(),e=0;e<Be.length;e++){var n=Be[e];t>=e&&(n.isUnlocked=!0)}}();var Ue,ze,Ze=function(){function t(t,e,n){this.canvas=t,this.context=e,this.onSelectLevel=n.onSelectLevel,this.onBack=n.onBack,this.uiManager=new xe(e);this.initSettingsElements(.04),this.initLevelElements(.54),this.initButtons(.1)}return t.prototype.update=function(t){if(this.uiManager.onMouseMove(p.getMouseCanvasCoords()),p.hasClick()){var e=p.handleClick();this.uiManager.onClick(e)}},t.prototype.render=function(){this.context.fillStyle=et,this.context.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.context.fillRect(0,0,a.canvasWidth,a.canvasHeight),this.renderTitleText(),this.uiManager.render()},t.prototype.destroy=function(){},t.prototype.initButtons=function(t){var e=this,n=new y(.18,.08),a=new fe({dimensions:{size:n,topLeft:new y(t,.9),text:"Back"},style:{fontSize:22,color:"#d9c8a3",hoverColor:"#e6dbc3",textColor:nt},onClick:this.onBack});this.uiManager.addElement(a);var r=t+n.x+.04,i=new fe({dimensions:{size:n,text:"Start",topLeft:new y(r,.9)},style:{color:"#66d15a",hoverColor:"#7aed6d",fontSize:28,textColor:nt},onClick:function(){var t=e.selectedTeamSizeMap.get(1)>16?16:rt,n={matchType:e.selectedMatchType,teamIndexToSquadSize:e.selectedTeamSizeMap,maxSpawnDistanceFromFlag:t,numTeams:it,hasFogOfWar:e.isFogOfWarOn,aiDifficulty:e.selectedAiDifficulty,hasSpawners:e.hasSpawners};e.onSelectLevel(e.selectedLevelIndex,n)}});this.uiManager.addElement(i)},t.prototype.initSettingsElements=function(t){var e=this,n=new y(.09,.06),a=new y(.18,.08),r=.18+.02+a.y,i={color:"#dddddd",fontSize:22,textColor:"#000000"},o={color:et,fontSize:20,textColor:"#000000"},s={fontSize:20,color:"#f7c25e",hoverColor:"#deaf57",selectedColor:"#db9d2a",selectedBorderColor:"#000000",textColor:nt},l=new de({dimensions:{size:a,text:"Settings",topLeft:new y(.25-a.x/2,.18)},style:i});this.uiManager.addElement(l);var c=function(e){for(var a=new y(.14,.06),r=t,i=new de({dimensions:{size:a,text:e.headerText,topLeft:new y(r,e.topY)},style:o}),l=r+a.x+.02,c=[],h=0;h<e.buttonTexts.length;h++){var u=h%3,x=Math.floor(h/3),d=l+u*(.04+n.y),f=e.topY+x*(.02+n.y);c.push({topLeft:new y(d,f),size:n,text:e.buttonTexts[h]})}return e.onButtonChangeCallback(e.initialButtonIndex),[i,new ge({buttons:c,buttonStyle:s,initialSelectionIndex:e.initialButtonIndex,onChangeCallback:e.onButtonChangeCallback})]},h=[new Map([[0,2],[1,2]]),new Map([[0,4],[1,4]]),new Map([[0,8],[1,8]]),new Map([[0,12],[1,12]]),new Map([[0,8],[1,24]])],u=h.map((function(t){return t.get(0)+"x"+t.get(1)})),x=r,d=x+2*n.y+.02+.04,f=d+n.y+.04,g=f+n.y+.04,m=g+n.y+.04,p=c({topY:x,rows:2,headerText:"Team size",buttonTexts:u,initialButtonIndex:0,onButtonChangeCallback:function(t){e.selectedTeamSizeMap=h[t]}});this.uiManager.addElement(p[0]),this.uiManager.addElement(p[1]);var T=[w.WEAK,w.MEDIUM,w.STRONG],v=c({topY:f,rows:1,headerText:"Difficulty",buttonTexts:["Easy","Medium","Hard"],initialButtonIndex:0,onButtonChangeCallback:function(t){e.selectedAiDifficulty=T[t]}});this.uiManager.addElement(v[0]),this.uiManager.addElement(v[1]);var S=[I.PLAYER_VS_PLAYER_LOCAL,I.PLAYER_VS_AI,I.AI_VS_AI],C=c({topY:d,rows:1,headerText:"Match type",buttonTexts:["PvP","PvAI","AIvAI"],initialButtonIndex:1,onButtonChangeCallback:function(t){var n=e.selectedMatchType;e.selectedMatchType=S[t],e.selectedMatchType===I.PLAYER_VS_PLAYER_LOCAL&&n!==I.PLAYER_VS_PLAYER_LOCAL?(e.uiManager.removeElement(v[0]),e.uiManager.removeElement(v[1])):e.selectedMatchType!==I.PLAYER_VS_PLAYER_LOCAL&&n===I.PLAYER_VS_PLAYER_LOCAL&&(e.uiManager.addElement(v[0]),e.uiManager.addElement(v[1]))}});this.uiManager.addElement(C[0]),this.uiManager.addElement(C[1]);var E=[!0,!1],A=c({topY:g,rows:1,headerText:"Fog of war",buttonTexts:["On","Off"],initialButtonIndex:1,onButtonChangeCallback:function(t){e.isFogOfWarOn=E[t]}});this.uiManager.addElement(A[0]),this.uiManager.addElement(A[1]);var L=[!0,!1],M=c({topY:m,rows:1,headerText:"Spawners",buttonTexts:["On","Off"],initialButtonIndex:1,onButtonChangeCallback:function(t){e.hasSpawners=L[t]}});this.uiManager.addElement(M[0]),this.uiManager.addElement(M[1])},t.prototype.initLevelElements=function(t){var e=this,n=new y(.18,.08),a=.18+.02+n.y,r={color:"#dddddd",fontSize:22,textColor:"#000000"},i={fontSize:22,color:"#f7c25e",hoverColor:"#deaf57",selectedColor:"#db9d2a",selectedBorderColor:"#000000",textColor:nt},o=t,s=o+n.x/2+.02,l=new de({dimensions:{size:n,text:"Level",topLeft:new y(s,.18)},style:r});this.uiManager.addElement(l);for(var c=[],h=0;h<at.length;h++){var u=h%6,x=o;1===Math.floor(h/6)&&(x=x+n.x+.04);var d=a+.02*u+u*n.y,f=at[h];c.push({topLeft:new y(x,d),size:n,text:f.name})}var g=function(t){e.selectedLevelIndex=t};g(0),this.uiManager.addElement(new ge({buttons:c,buttonStyle:i,initialSelectionIndex:0,onChangeCallback:g}))},t.prototype.renderTitleText=function(){this.context.fillStyle=nt;this.context.font="72px fantasy";var t=this.context.measureText("Free Play").width,e=new y(a.canvasWidth/2,a.canvasHeight/6);this.context.fillText("Free Play",e.x-t/2,e.y-36)},t}(),qe=function(){function t(t,e,n){this.canvas=t,this.context=e,this.onSelectLevel=n.onSelectLevel,this.onBack=n.onBack,this.uiManager=new xe(e),this.initLevelMenu()}return t.prototype.update=function(t){if(this.uiManager.onMouseMove(p.getMouseCanvasCoords()),p.hasClick()){var e=p.handleClick();this.uiManager.onClick(e)}},t.prototype.render=function(){this.context.fillStyle=et,this.context.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.context.fillRect(0,0,a.canvasWidth,a.canvasHeight),this.renderTitleText(),this.uiManager.render()},t.prototype.destroy=function(){},t.prototype.initLevelMenu=function(){for(var t=this,e=new y(.24,.08),n=.2+.04+e.y,a={fontSize:24,color:"#f7c25e",hoverColor:"#fcd281",selectedColor:"#db9d2a",selectedBorderColor:"#000000",textColor:nt},r={fontSize:24,color:"#bd7e00",textColor:nt},i=.5-e.x/2,o=i-e.x-.1,s=i+e.x+.1,l=Be.length/3,c=function(c){var u=Math.floor(c/l),x=c%l,d=n+.04*x+x*e.y,f=Be[c],g=o;1===u?g=i:2===u&&(g=s);var m={topLeft:new y(g,d),size:e,text:f.isUnlocked?f.levelName:"Locked"};f.isUnlocked?h.uiManager.addElement(new fe({dimensions:m,style:a,onClick:function(){var e={matchType:I.PLAYER_VS_AI,teamIndexToSquadSize:f.teamIndexToSquadSize,numTeams:it,maxSpawnDistanceFromFlag:rt,hasFogOfWar:!0,hasSpawners:!0,aiDifficulty:f.aiDifficulty};t.onSelectLevel(c,f.levelIndex,e)}})):h.uiManager.addElement(new de({dimensions:m,style:r}))},h=this,u=0;u<Be.length;u++)c(u);var x=new fe({dimensions:{size:e,topLeft:new y(.08,.86),text:"Back"},style:{fontSize:24,color:"#d9c8a3",hoverColor:"#e6dbc3",textColor:nt},onClick:this.onBack});this.uiManager.addElement(x)},t.prototype.renderTitleText=function(){this.context.fillStyle=nt;this.context.font="72px fantasy";var t="Single Player Campaign",e=this.context.measureText(t).width,n=new y(a.canvasWidth/2,a.canvasHeight/6);this.context.fillText(t,n.x-e/2,n.y-36)},t}(),je=function(){function t(t,e,n){this.canvas=t,this.context=e,this.onFreePlay=n.onFreePlay,this.onCampaign=n.onCampaign,this.onCreateLevel=n.onCreateLevel,this.uiManager=new xe(e),this.initMenu()}return t.prototype.update=function(t){if(this.uiManager.onMouseMove(p.getMouseCanvasCoords()),p.hasClick()){var e=p.handleClick();this.uiManager.onClick(e)}},t.prototype.render=function(){this.context.fillStyle=et,this.context.clearRect(0,0,a.canvasWidth,a.canvasHeight),this.context.fillRect(0,0,a.canvasWidth,a.canvasHeight),this.renderTitleText(),this.uiManager.render()},t.prototype.destroy=function(){},t.prototype.initMenu=function(){for(var t=new y(.26,.1),e=.5-t.x/2,n=[{text:"Campaign mode",callback:this.onCampaign},{text:"Free play",callback:this.onFreePlay},{text:"Create Level",callback:this.onCreateLevel}],a=0;a<n.length;a++){var r=.3+.08*a+a*t.y,i=n[a],o=new fe({dimensions:{topLeft:new y(e,r),size:t,text:i.text},style:{fontSize:24,color:"#f7c25e",hoverColor:"#fcd281",textColor:nt},onClick:i.callback});this.uiManager.addElement(o)}},t.prototype.renderTitleText=function(){this.context.fillStyle=nt;this.context.font="72px fantasy";var t="Snag the Flag",e=this.context.measureText(t).width,n=new y(a.canvasWidth/2,a.canvasHeight/4);this.context.fillText(t,n.x-e/2,n.y-36)},t}();(ze=Ue||(Ue={}))[ze.START_MENU=0]="START_MENU",ze[ze.FREE_PLAY_MENU=1]="FREE_PLAY_MENU",ze[ze.CAMPAIGN_MENU=2]="CAMPAIGN_MENU",ze[ze.GAME=3]="GAME",ze[ze.LEVEL_CREATOR=4]="LEVEL_CREATOR";var Ke=function(){function t(){var t=this;this.lastRenderTime=0,this.gameState=Ue.START_MENU,this.onSelectFreePlayLevel=function(e,n){t.initGame(e,n,(function(e){t.tearDownCurrentGameState(),t.initFreePlayMenu()}))},this.onSelectCampaignLevel=function(e,n,a){t.initGame(n,a,(function(n){var a,r;0===n&&(a=e+1,r=We(),a<Be.length&&a>r&&(Be[a].isUnlocked=!0,window.localStorage.setItem("SnagTheFlag_Campgain_LastUnlockedCampaignLevelIndex",""+a))),t.tearDownCurrentGameState(),t.initCampaignMenu()}))},this.onBack=function(){t.tearDownCurrentGameState(),t.initStartMenu()},this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),document.body.classList.add("body"),this.canvas.setAttribute("height",a.canvasHeight+"px"),this.canvas.setAttribute("width",a.canvasWidth+"px"),this.context=this.canvas.getContext("2d"),p.initMouseControls(this.canvas),this.initStartMenu(),window.requestAnimationFrame((function(e){t.lastRenderTime=e,t.gameLoop(e)}))}return t.prototype.gameLoop=function(t){var e=this,n=t-this.lastRenderTime;n>a.msBetweenRenders&&(this.lastRenderTime=t,this.gameStateManager.update(n),this.gameStateManager.render()),window.requestAnimationFrame((function(t){e.gameLoop(t)}))},t.prototype.initStartMenu=function(){var t=this;this.gameState=Ue.START_MENU,this.gameStateManager=new je(this.canvas,this.context,{onFreePlay:function(){t.tearDownCurrentGameState(),t.initFreePlayMenu()},onCampaign:function(){t.tearDownCurrentGameState(),t.initCampaignMenu()},onCreateLevel:function(){t.tearDownCurrentGameState(),t.initLevelCreator()}})},t.prototype.initGame=function(t,e,n){this.gameState=Ue.GAME,this.gameStateManager=new Ne(this.canvas,this.context,{gameSettings:e,levelIndex:t,onExitGameCallback:n})},t.prototype.initFreePlayMenu=function(){this.gameState=Ue.FREE_PLAY_MENU,this.gameStateManager=new Ze(this.canvas,this.context,{onSelectLevel:this.onSelectFreePlayLevel,onBack:this.onBack})},t.prototype.initCampaignMenu=function(){this.gameState=Ue.CAMPAIGN_MENU,this.gameStateManager=new qe(this.canvas,this.context,{onSelectLevel:this.onSelectCampaignLevel,onBack:this.onBack})},t.prototype.initLevelCreator=function(){var t=this;this.gameState=Ue.LEVEL_CREATOR,this.gameStateManager=new Ge(this.canvas,this.context,(function(){t.tearDownCurrentGameState(),t.initStartMenu()}))},t.prototype.tearDownCurrentGameState=function(){this.gameStateManager.destroy()},t}(),Ve=!1;document.onreadystatechange=function(){"complete"!==document.readyState||Ve||(new Ke,Ve=!0)}}]);
//# sourceMappingURL=app.bundle.js.map